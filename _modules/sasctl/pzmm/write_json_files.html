
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" data-theme="dark">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sasctl.pzmm.write_json_files &#8212; sasctl 1.10.7 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "dark";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "dark";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sasctl.css?v=6840086e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=93ada2c2"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/sasctl/pzmm/write_json_files';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Oct 02, 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="dark">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">sasctl 1.10.7 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api/sasctl.html">
    sasctl package
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/sassoftware/python-sasctl" title="sasctl" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../../_static/sas_logo.svg" class="icon-link-image" alt="sasctl"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api/sasctl.html">
    sasctl package
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/sassoftware/python-sasctl" title="sasctl" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../../_static/sas_logo.svg" class="icon-link-image" alt="sasctl"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">sasctl.pzmm....</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for sasctl.pzmm.write_json_files</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2020, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.</span>
<span class="c1"># SPDX-License-Identifier: Apache-2.0</span>

<span class="c1"># Standard Library Imports</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">pickletools</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="c1"># Third Party Imports</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>

<span class="c1"># Package Imports</span>
<span class="kn">from</span> <span class="nn">sasctl.pzmm.write_score_code</span> <span class="kn">import</span> <span class="n">ScoreCode</span> <span class="k">as</span> <span class="n">sc</span>
<span class="kn">from</span> <span class="nn">..core</span> <span class="kn">import</span> <span class="n">current_session</span>
<span class="kn">from</span> <span class="nn">..utils.decorators</span> <span class="kn">import</span> <span class="n">deprecated</span><span class="p">,</span> <span class="n">experimental</span>
<span class="kn">from</span> <span class="nn">..utils.misc</span> <span class="kn">import</span> <span class="n">check_if_jupyter</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># noinspection PyPackageRequirements</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

    <span class="k">class</span> <span class="nc">NpEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
<div class="viewcode-block" id="NpEncoder.default">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.NpEncoder.default">[docs]</a>
        <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div>


<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">np</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="NpEncoder">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.NpEncoder">[docs]</a>
    <span class="k">class</span> <span class="nc">NpEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
        <span class="k">pass</span></div>



<span class="c1"># TODO: add converter for any type of dataset (list, dataframe, numpy array)</span>

<span class="c1"># Constants</span>
<span class="n">INPUT</span> <span class="o">=</span> <span class="s2">&quot;inputVar.json&quot;</span>
<span class="n">OUTPUT</span> <span class="o">=</span> <span class="s2">&quot;outputVar.json&quot;</span>
<span class="n">PROP</span> <span class="o">=</span> <span class="s2">&quot;ModelProperties.json&quot;</span>
<span class="n">META</span> <span class="o">=</span> <span class="s2">&quot;fileMetadata.json&quot;</span>
<span class="n">FITSTAT</span> <span class="o">=</span> <span class="s2">&quot;dmcas_fitstat.json&quot;</span>
<span class="n">ROC</span> <span class="o">=</span> <span class="s2">&quot;dmcas_roc.json&quot;</span>
<span class="n">LIFT</span> <span class="o">=</span> <span class="s2">&quot;dmcas_lift.json&quot;</span>
<span class="n">MAXDIFFERENCES</span> <span class="o">=</span> <span class="s2">&quot;maxDifferences.json&quot;</span>
<span class="n">GROUPMETRICS</span> <span class="o">=</span> <span class="s2">&quot;groupMetrics.json&quot;</span>
<span class="n">VARIMPORTANCES</span> <span class="o">=</span> <span class="s2">&quot;dmcas_relativeimportance.json&quot;</span>
<span class="n">MISC</span> <span class="o">=</span> <span class="s2">&quot;dmcas_misc.json&quot;</span>


<span class="k">def</span> <span class="nf">_flatten</span><span class="p">(</span><span class="n">nested_list</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flatten a nested list.</span>

<span class="sd">    Flattens a nested list, while controlling for str values in list, such that the</span>
<span class="sd">    str values are not expanded into a list of single characters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nested_list : list</span>
<span class="sd">        A nested list of strings.</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    list</span>
<span class="sd">        A flattened list of strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nested_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
            <span class="k">yield from</span> <span class="n">_flatten</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">item</span>


<div class="viewcode-block" id="JSONFiles">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles">[docs]</a>
<span class="k">class</span> <span class="nc">JSONFiles</span><span class="p">:</span>
    <span class="n">notebook_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">check_if_jupyter</span><span class="p">()</span>
    <span class="n">valid_params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;_RASE_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_NObs_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_GINI_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_GAMMA_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_MCE_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_ASE_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_MCLL_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_KS_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_KSPostCutoff_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_DIV_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_TAU_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_KSCut_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_C_&quot;</span><span class="p">,</span>
    <span class="p">]</span>

<div class="viewcode-block" id="JSONFiles.write_var_json">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.write_var_json">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">write_var_json</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span><span class="p">],</span>
        <span class="n">is_input</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">json_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a variable descriptor JSON file for input or output variables,</span>
<span class="sd">        based on input data containing predictor and prediction columns.</span>

<span class="sd">        If a path is provided, this function creates a JSON file named either</span>
<span class="sd">        inputVar.json or outputVar.json based on argument inputs. Otherwise, a dict</span>
<span class="sd">        is returned with the key-value pair representing the file name and json dump</span>
<span class="sd">        respectively.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input_data : pandas.DataFrame, pandas.Series, or list of dict</span>
<span class="sd">            Input dataframe containing the training data set in a pandas.Dataframe</span>
<span class="sd">            format. Columns are used to define predictor and prediction variables</span>
<span class="sd">            (ambiguously named &quot;predict&quot;). Providing a list of dict objects signals</span>
<span class="sd">            that the model files are being created from an MLFlow model.</span>
<span class="sd">        is_input : bool, optional</span>
<span class="sd">            Boolean flag to check if generating the input or output variable JSON. The</span>
<span class="sd">            default value is True.</span>
<span class="sd">        json_path : str or pathlib.Path, optional</span>
<span class="sd">            File location for the output JSON file. The default value is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing a key-value pair representing the file name and json</span>
<span class="sd">            dump respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># MLFlow model handling</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">dict_list</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">generate_mlflow_variable_properties</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
        <span class="c1"># Normal model handling</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dict_list</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">generate_variable_properties</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">json_path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_input</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">INPUT</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">OUTPUT</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">json_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dict_list</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">notebook_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> was successfully written and saved to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_input</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">INPUT</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dict_list</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">OUTPUT</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dict_list</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)}</span></div>


<div class="viewcode-block" id="JSONFiles.generate_variable_properties">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.generate_variable_properties">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">generate_variable_properties</span><span class="p">(</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a list of dictionaries of variable properties given an input dataframe.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input_data : pandas.DataFrame or pandas.Series</span>
<span class="sd">            Dataset for either the input or output example data for the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict_list : list of dict</span>
<span class="sd">            List of dictionaries containing the variable properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if input_data is a Series or DataFrame</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">predict_names</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">is_series</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">predict_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_data</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">is_series</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Loop through variables to determine properties</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">predict_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_series</span><span class="p">:</span>
                <span class="n">predict</span> <span class="o">=</span> <span class="n">input_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">predict</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">first_row</span> <span class="o">=</span> <span class="n">predict</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">predict</span><span class="o">.</span><span class="n">first_valid_index</span><span class="p">()]</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">predict</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">name</span>
            <span class="n">is_str</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">first_row</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>

            <span class="n">var_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">is_str</span><span class="p">:</span>
                <span class="n">var_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;nominal&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">predict</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span>
                    <span class="n">var_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;nominal&quot;</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">var_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;interval&quot;</span><span class="p">})</span>
                <span class="n">var_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;decimal&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>

            <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dict_list</span></div>


<div class="viewcode-block" id="JSONFiles.generate_mlflow_variable_properties">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.generate_mlflow_variable_properties">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">generate_mlflow_variable_properties</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a list of dictionaries containing the variable properties found in the</span>
<span class="sd">        MLModel file for MLFlow model runs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input_data : list of dict</span>
<span class="sd">            Data pulled from the MLModel file by mlflow_model.py.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict_list : list of dict</span>
<span class="sd">            List of dictionaries containing the variable properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle MLFlow models with different `var` formatting</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">predict_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">predict_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">]</span>

        <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">predict_names</span><span class="p">):</span>
            <span class="n">is_str</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">check_if_string</span><span class="p">(</span><span class="n">input_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">var_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">is_str</span><span class="p">:</span>
                <span class="n">var_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;nominal&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">var_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;interval&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;decimal&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
            <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dict_list</span></div>


<div class="viewcode-block" id="JSONFiles.check_if_string">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.check_if_string">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">check_if_string</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine if an MLFlow variable in data is a string type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : dict</span>
<span class="sd">            Dictionary representation of a single variable from an MLFlow model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the variable is a string. False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;tensor&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tensor-spec&quot;</span><span class="p">][</span><span class="s2">&quot;dtype&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="JSONFiles.write_model_properties_json">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.write_model_properties_json">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">write_model_properties_json</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">target_variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">target_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">json_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model_desc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model_algorithm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model_function</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">modeler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">train_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a JSON file containing SAS Model Manager model properties.</span>

<span class="sd">        Property values for multiclass models are not supported on a model-level in SAS</span>
<span class="sd">        Model Manager. If these values are detected, they will be supplied as custom</span>
<span class="sd">        user properties.</span>

<span class="sd">        If a json_path is supplied, this function outputs a JSON file named</span>
<span class="sd">        &quot;ModelProperties.json&quot;. Otherwise, a dict is returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_name : str</span>
<span class="sd">            User-defined model name. This value is overwritten by SAS Model Manager</span>
<span class="sd">            based on the name of the zip file used for importing the model.</span>
<span class="sd">        target_variable : str</span>
<span class="sd">            Target variable to be predicted by the model.</span>
<span class="sd">        target_values : list, optional</span>
<span class="sd">            Model target event(s). Providing no target values indicates the model is a</span>
<span class="sd">            regression model. Providing 2 target values indicates the model is a binary</span>
<span class="sd">            classification model. Providing &gt; 2 target values will supply the values</span>
<span class="sd">            for the different target events as a custom property. An error is raised if</span>
<span class="sd">            only 1 target value is supplied. The default value is None.</span>
<span class="sd">        json_path : str or pathlib.Path, optional</span>
<span class="sd">            Path for an output ModelProperties.json file to be generated. If no value</span>
<span class="sd">            is supplied a dict is returned instead. The default value is None.</span>
<span class="sd">        model_desc : str, optional</span>
<span class="sd">            User-defined model description. The default value is an empty string.</span>
<span class="sd">        model_algorithm : str, optional</span>
<span class="sd">            User-defined model algorithm name. The default value is an empty string.</span>
<span class="sd">        model_function : str, optional</span>
<span class="sd">            User-defined model function name. The default value is an empty string.</span>
<span class="sd">        modeler : str, optional</span>
<span class="sd">            User-defined value for the name of the modeler. The default value is an</span>
<span class="sd">            empty string.</span>
<span class="sd">        train_table : str, optional</span>
<span class="sd">            The path to the model&#39;s training table within SAS Viya. The default value is</span>
<span class="sd">            an empty string.</span>
<span class="sd">        properties : list of dict, optional</span>
<span class="sd">            List of custom properties to be shown in the user-defined properties section</span>
<span class="sd">            of the model in SAS Model Manager. Dict entries should contain the `name`,</span>
<span class="sd">            `value`, and `type` keys. The default value is an empty list.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing a key-value pair representing the file name and json</span>
<span class="sd">            dump respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">model_desc</span><span class="p">:</span>
            <span class="c1"># Check if model description is smaller than the 1024-character limit</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_desc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">:</span>
                <span class="n">model_desc</span> <span class="o">=</span> <span class="n">model_desc</span><span class="p">[:</span><span class="mi">1024</span><span class="p">]</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;WARNING: The provided model description was truncated to 1024 &quot;</span>
                    <span class="s2">&quot;characters.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_values</span><span class="p">:</span>
            <span class="n">model_function</span> <span class="o">=</span> <span class="n">model_function</span> <span class="k">if</span> <span class="n">model_function</span> <span class="k">else</span> <span class="s2">&quot;prediction&quot;</span>
            <span class="n">target_level</span> <span class="o">=</span> <span class="s2">&quot;Interval&quot;</span>
            <span class="n">target_event</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">event_prob_var</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_values</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">model_function</span> <span class="o">=</span> <span class="n">model_function</span> <span class="k">if</span> <span class="n">model_function</span> <span class="k">else</span> <span class="s2">&quot;classification&quot;</span>
            <span class="n">target_level</span> <span class="o">=</span> <span class="s2">&quot;Binary&quot;</span>
            <span class="n">target_event</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">event_prob_var</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;P_</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_values</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">model_function</span> <span class="o">=</span> <span class="n">model_function</span> <span class="k">if</span> <span class="n">model_function</span> <span class="k">else</span> <span class="s2">&quot;classification&quot;</span>
            <span class="n">target_level</span> <span class="o">=</span> <span class="s2">&quot;Nominal&quot;</span>
            <span class="n">target_event</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">event_prob_var</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">target_values</span><span class="p">]</span>
            <span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;multiclass_target_events&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">targets</span><span class="p">),</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">prob_targets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;P_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">target_values</span><span class="p">]</span>
            <span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;multiclass_proba_variables&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prob_targets</span><span class="p">),</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Please provide all possible values for the target variable, including&quot;</span>
                <span class="s2">&quot; a no-event value.&quot;</span>
            <span class="p">)</span>

        <span class="n">truncated_properties</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">truncate_properties</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="n">truncated_properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="n">python_version</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">output_json</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">model_desc</span> <span class="k">if</span> <span class="n">model_desc</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;scoreCodeType&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trainTable&quot;</span><span class="p">:</span> <span class="n">train_table</span> <span class="k">if</span> <span class="n">train_table</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trainCodeType&quot;</span><span class="p">:</span> <span class="s2">&quot;Python&quot;</span><span class="p">,</span>
            <span class="s2">&quot;algorithm&quot;</span><span class="p">:</span> <span class="n">model_algorithm</span> <span class="k">if</span> <span class="n">model_algorithm</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="n">model_function</span> <span class="k">if</span> <span class="n">model_function</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;targetVariable&quot;</span><span class="p">:</span> <span class="n">target_variable</span> <span class="k">if</span> <span class="n">target_variable</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;targetEvent&quot;</span><span class="p">:</span> <span class="n">target_event</span> <span class="k">if</span> <span class="n">target_event</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;targetLevel&quot;</span><span class="p">:</span> <span class="n">target_level</span> <span class="k">if</span> <span class="n">target_level</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eventProbVar&quot;</span><span class="p">:</span> <span class="n">event_prob_var</span> <span class="k">if</span> <span class="n">event_prob_var</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;modeler&quot;</span><span class="p">:</span> <span class="n">modeler</span> <span class="k">if</span> <span class="n">modeler</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="s2">&quot;Python 3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;toolVersion&quot;</span><span class="p">:</span> <span class="n">python_version</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">truncated_properties</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">json_path</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">PROP</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">json_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">output_json</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">notebook_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">PROP</span><span class="si">}</span><span class="s2"> was successfully written and saved to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PROP</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">PROP</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">output_json</span><span class="p">)}</span></div>


<div class="viewcode-block" id="JSONFiles.truncate_properties">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.truncate_properties">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">truncate_properties</span><span class="p">(</span><span class="n">prop</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check custom properties for values larger than SAS Model Manager expects.</span>

<span class="sd">        Property names cannot be larger than 60 characters. Property values cannot be</span>
<span class="sd">        larger than 512 characters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Key-value pair representing the property name and value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Key-value pair, which was truncated as needed by SAS Model Manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop_key</span><span class="p">,</span> <span class="n">prop_value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop_key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;WARNING: The property name </span><span class="si">{</span><span class="n">prop_key</span><span class="si">}</span><span class="s2"> was truncated to 60 &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;characters.&quot;</span>
            <span class="p">)</span>
            <span class="n">truncated_name</span> <span class="o">=</span> <span class="n">prop_key</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span>
            <span class="n">prop</span><span class="p">[</span><span class="n">truncated_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">prop_key</span><span class="p">)</span>
            <span class="n">prop_key</span> <span class="o">=</span> <span class="n">truncated_name</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">512</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;WARNING: The property value </span><span class="si">{</span><span class="n">prop_value</span><span class="si">}</span><span class="s2"> was truncated to 512 &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;characters.&quot;</span>
            <span class="p">)</span>
            <span class="n">truncated_value</span> <span class="o">=</span> <span class="n">prop_value</span><span class="p">[:</span><span class="mi">512</span><span class="p">]</span>
            <span class="n">prop</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">prop_key</span><span class="p">:</span> <span class="n">truncated_value</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">prop</span></div>


<div class="viewcode-block" id="JSONFiles.write_file_metadata_json">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.write_file_metadata_json">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">write_file_metadata_json</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">model_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">json_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">is_h2o_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">is_tf_keras_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a file metadata JSON file pointing to all relevant files.</span>

<span class="sd">        This function outputs a JSON file named &quot;fileMetadata.json&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_prefix : str</span>
<span class="sd">            The variable for the model name that is used when naming model files. For</span>
<span class="sd">            example: hmeqClassTree + [Score.py | .pickle].</span>
<span class="sd">        json_path : str or pathlib.Path, optional</span>
<span class="sd">            Path for an output ModelProperties.json file to be generated. If no value</span>
<span class="sd">            is supplied a dict is returned instead. The default value is None.</span>
<span class="sd">        is_h2o_model : bool, optional</span>
<span class="sd">            Sets whether the model metadata is associated with an H2O.ai model. If set</span>
<span class="sd">            as True, the MOJO model file will be set as a score resource. The default</span>
<span class="sd">            value is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing a key-value pair representing the file name and json</span>
<span class="sd">            dump respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.write_score_code</span> <span class="kn">import</span> <span class="n">ScoreCode</span>

        <span class="n">sanitized_prefix</span> <span class="o">=</span> <span class="n">ScoreCode</span><span class="o">.</span><span class="n">sanitize_model_prefix</span><span class="p">(</span><span class="n">model_prefix</span><span class="p">)</span>

        <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;inputVariables&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">INPUT</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;outputVariables&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">OUTPUT</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;score_</span><span class="si">{</span><span class="n">sanitized_prefix</span><span class="si">}</span><span class="s2">.py&quot;</span><span class="p">},</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">is_h2o_model</span><span class="p">:</span>
            <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;scoreResource&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">sanitized_prefix</span> <span class="o">+</span> <span class="s2">&quot;.mojo&quot;</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_tf_keras_model</span><span class="p">:</span>
            <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;scoreResource&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">sanitized_prefix</span> <span class="o">+</span> <span class="s2">&quot;.h5&quot;</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;scoreResource&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">sanitized_prefix</span> <span class="o">+</span> <span class="s2">&quot;.pickle&quot;</span><span class="p">}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">json_path</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">META</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">json_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dict_list</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">notebook_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">META</span><span class="si">}</span><span class="s2"> was successfully written and saved to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">META</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">META</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dict_list</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)}</span></div>


<div class="viewcode-block" id="JSONFiles.input_fit_statistics">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.input_fit_statistics">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">input_fit_statistics</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">fitstat_df</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">user_input</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">tuple_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">json_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a JSON file to display fit statistics for the model in SAS Model Manager.</span>

<span class="sd">        There are three modes to add fit parameters to the JSON file:</span>

<span class="sd">        1. Call the function with additional tuple arguments containing</span>
<span class="sd">        the name of the parameter, its value, and the partition that it</span>
<span class="sd">        belongs to.</span>

<span class="sd">        2. Provide line by line user input prompted by the function.</span>

<span class="sd">        3. Import values from a CSV file. Format should contain the above</span>
<span class="sd">        tuple in each row.</span>

<span class="sd">        The following are the base statistical parameters SAS Viya supports:</span>

<span class="sd">        * RASE = Root Average Squared Error</span>
<span class="sd">        * NObs = Sum of Frequencies</span>
<span class="sd">        * GINI = Gini Coefficient</span>
<span class="sd">        * GAMMA = Gamma</span>
<span class="sd">        * MCE = Misclassification Rate</span>
<span class="sd">        * ASE = Average Squared Error</span>
<span class="sd">        * MCLL = Multi-Class Log Loss</span>
<span class="sd">        * KS = KS (Youden)</span>
<span class="sd">        * KSPostCutoff = ROC Separation</span>
<span class="sd">        * DIV = Divisor for ASE</span>
<span class="sd">        * TAU = Tau</span>
<span class="sd">        * KSCut = KS Cutoff</span>
<span class="sd">        * C = Area Under ROC</span>

<span class="sd">        This function outputs a JSON file named &quot;dmcas_fitstat.json&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fitstat_df : pandas.DataFrame, optional</span>
<span class="sd">            Dataframe containing fitstat parameters and values. The default value is</span>
<span class="sd">            None.</span>
<span class="sd">        user_input : bool, optional</span>
<span class="sd">            If true, prompt the user for more parameters. The default value is false.</span>
<span class="sd">        tuple_list : list of tuple, optional</span>
<span class="sd">            Input parameter tuples in the form of (parameterName, parameterValue,</span>
<span class="sd">            data_role). For example, a sample parameter call would be</span>
<span class="sd">            &#39;NObs&#39;, 3488, or &#39;TRAIN&#39;. Variable data_role is typically either TRAIN,</span>
<span class="sd">            TEST, or VALIDATE or 1, 2, 3 respectively. The default value is None.</span>
<span class="sd">        json_path : str or pathlib.Path, optional</span>
<span class="sd">            Location for the output JSON file. The default value is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing a key-value pair representing the file name and json</span>
<span class="sd">            dump respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">json_template_path</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;template_files/dmcas_fitstat.json&quot;</span>
        <span class="p">)</span>
        <span class="n">json_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_json_file</span><span class="p">(</span><span class="n">json_template_path</span><span class="p">)</span>

        <span class="n">data_map</span> <span class="o">=</span> <span class="p">[{},</span> <span class="p">{},</span> <span class="p">{}]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">data_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_dict</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">tuple_list</span><span class="p">:</span>
            <span class="n">data_map</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">add_tuple_to_fitstat</span><span class="p">(</span><span class="n">data_map</span><span class="p">,</span> <span class="n">tuple_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">user_input</span><span class="p">:</span>
            <span class="n">data_map</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">user_input_fitstat</span><span class="p">(</span><span class="n">data_map</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fitstat_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_map</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">add_df_to_fitstat</span><span class="p">(</span><span class="n">fitstat_df</span><span class="p">,</span> <span class="n">data_map</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">json_dict</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">json_path</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">FITSTAT</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">json_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">notebook_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">FITSTAT</span><span class="si">}</span><span class="s2"> was successfully written and saved to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">FITSTAT</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">FITSTAT</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)}</span></div>


<div class="viewcode-block" id="JSONFiles.add_tuple_to_fitstat">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.add_tuple_to_fitstat">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_tuple_to_fitstat</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Using tuples defined in input_fit_statistics, add them to the dmcas_fitstat json</span>
<span class="sd">        dictionary.</span>

<span class="sd">        Warnings are produced for invalid parameters found in the tuple.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list of dict</span>
<span class="sd">            List of dicts for the data values of each parameter. Split into the three</span>
<span class="sd">            valid partitions (TRAIN, TEST, VALIDATE).</span>
<span class="sd">        parameters : list of tuple</span>
<span class="sd">            User-provided data for each parameter per partition provided.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of dict</span>
<span class="sd">            List of dicts with the tuple values inputted.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If an parameter within the tuple list is not a tuple or has a length</span>
<span class="sd">            different from the expected three.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="c1"># Produce a warning or error for invalid parameter names or formatting</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">param_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_parameter</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">valid_params</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;WARNING: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> is not a valid parameter and has been &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;ignored.&quot;</span><span class="p">,</span>
                        <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">data_role</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">convert_data_role</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data_role</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="n">data_role</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected a tuple, but got </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">))</span><span class="si">}</span><span class="s2"> instead.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected a tuple with three parameters, but instead got tuple &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;with length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="JSONFiles.user_input_fitstat">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.user_input_fitstat">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">user_input_fitstat</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prompt the user to enter parameters for dmcas_fitstat.json.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list of dict</span>
<span class="sd">            List of dicts for the data values of each parameter. Split into the three</span>
<span class="sd">            valid partitions (TRAIN, TEST, VALIDATE).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of dict</span>
<span class="sd">            List of dicts with the user provided values inputted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">input_param_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;What is the parameter name?</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_parameter</span><span class="p">(</span><span class="n">input_param_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">valid_params</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_param_name</span><span class="si">}</span><span class="s2"> is not a valid parameter.&quot;</span><span class="p">,</span>
                    <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Would you like to input more parameters? (Y/N)&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">continue</span>
            <span class="n">param_value</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;What is the parameter&#39;s value?</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">input_data_role</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Which data role is the parameter associated with?</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data_role</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">data_role</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">convert_data_role</span><span class="p">(</span><span class="n">input_data_role</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">input_data_role</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
                <span class="n">data_role</span> <span class="o">=</span> <span class="n">input_data_role</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_data_role</span><span class="si">}</span><span class="s2"> is not a valid role value. It should be either &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;1, 2, or 3 or TRAIN, TEST, or VALIDATE respectively.&quot;</span><span class="p">,</span>
                    <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Would you like to input more parameters? (Y/N)&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">continue</span>
            <span class="n">data</span><span class="p">[</span><span class="n">data_role</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>

            <span class="k">if</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;More parameters? (Y/N)&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="JSONFiles.add_df_to_fitstat">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.add_df_to_fitstat">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_df_to_fitstat</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add parameters from provided DataFrame to the fitstats dictionary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pandas.DataFrame</span>
<span class="sd">            Dataframe containing fitstat parameters and values.</span>
<span class="sd">        data : list of dict</span>
<span class="sd">            List of dicts for the data values of each parameter. Split into the three</span>
<span class="sd">            valid partitions (TRAIN, TEST, VALIDATE).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of dict</span>
<span class="sd">            List of dicts with the user provided values inputted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
            <span class="n">input_param_name</span><span class="p">,</span> <span class="n">param_value</span><span class="p">,</span> <span class="n">data_role</span> <span class="o">=</span> <span class="n">row</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_parameter</span><span class="p">(</span><span class="n">input_param_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">valid_params</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_param_name</span><span class="si">}</span><span class="s2"> is not a valid parameter.&quot;</span><span class="p">,</span>
                    <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_role</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">data_role</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">convert_data_role</span><span class="p">(</span><span class="n">data_role</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_role</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data_role</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_role</span><span class="si">}</span><span class="s2"> is not a valid role value. It should be either &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;1, 2, or 3 or TRAIN, TEST, or VALIDATE respectively.&quot;</span><span class="p">,</span>
                    <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">data</span><span class="p">[</span><span class="n">data_role</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
        <span class="k">return</span> <span class="n">data</span></div>


    <span class="c1"># TODO: Add unit/integration tests</span>
<div class="viewcode-block" id="JSONFiles.assess_model_bias">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.assess_model_bias">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@experimental</span>
    <span class="k">def</span> <span class="nf">assess_model_bias</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">score_table</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">sensitive_values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">actual_values</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pred_values</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prob_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">levels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">json_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cutoff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">datarole</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span><span class="p">,</span>
        <span class="n">return_dataframes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates model bias metrics for sensitive variables and dumps metrics into SAS Viya readable JSON Files. This</span>
<span class="sd">        function works for regression and binary classification problems.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        score_table : pandas.DataFrame</span>
<span class="sd">            Data structure containing actual values, predicted or predicted probability values, and sensitive variable</span>
<span class="sd">            values. All columns in the score table must have valid variable names.</span>
<span class="sd">        sensitive_values : str or list of str</span>
<span class="sd">            Sensitive variable name or names in score_table. The variable name must follow SAS naming conventions (no</span>
<span class="sd">            spaces and the name cannot begin with a number or symbol).</span>
<span class="sd">        actual_values : str</span>
<span class="sd">            Variable name containing the actual values in score_table. The variable name must follow SAS naming</span>
<span class="sd">            conventions (no spaces and the name cannot begin with a number or symbol).</span>
<span class="sd">        pred_values : str</span>
<span class="sd">            Required for regression problems, otherwise not used</span>
<span class="sd">            Variable name containing the predicted values in score_table. The variable name must follow SAS naming</span>
<span class="sd">            conventions (no spaces and the name cannot begin with a number or symbol).Required for regression problems.</span>
<span class="sd">            The default value is None.</span>
<span class="sd">        prob_values : list of str</span>
<span class="sd">            Required for classification problems, otherwise not used</span>
<span class="sd">            A list of variable names containing the predicted probability values in the score table. The first element</span>
<span class="sd">            should represent the predicted probability of the target class. Required for classification problems. Default</span>
<span class="sd">            is None.</span>
<span class="sd">        levels : list of str, list of int, or list of bool</span>
<span class="sd">            Required for classification problems, otherwise not used</span>
<span class="sd">            List of classes of a nominal target in the order they were passed in prob_values. Levels must be passed as a</span>
<span class="sd">            string. Default is None.</span>
<span class="sd">        json_path : str or pathlib.Path, optional</span>
<span class="sd">            Location for the output JSON files. If a path is passed, the json files will populate in the directory and</span>
<span class="sd">            the function will return None, unless return_dataframes is True. Otherwise, the function will return the json</span>
<span class="sd">            strings in a dictionary (dict[&quot;maxDifferences.json&quot;] and dict[&quot;groupMetrics.json&quot;]). The default value is</span>
<span class="sd">            None.</span>
<span class="sd">        cutoff : float, optional</span>
<span class="sd">            Cutoff value for confusion matrix. Default is 0.5.</span>
<span class="sd">        datarole : str, optional</span>
<span class="sd">            The data being used to assess bias (i.e. &#39;TEST&#39;, &#39;VALIDATION&#39;, etc.). Default is &#39;TEST.&#39;</span>
<span class="sd">        return_dataframes : bool, optional</span>
<span class="sd">            If true, the function returns the pandas data frames used to create the JSON files and a table for bias</span>
<span class="sd">            metrics. If a JSON path is passed, then the function will return a dictionary that only includes the data</span>
<span class="sd">            frames (dict[&quot;maxDifferencesData&quot;], dict[&quot;groupMetricData&quot;], and dict[&quot;biasMetricsData&quot;]). If a JSON path is</span>
<span class="sd">            not passed, the function will return a dictionary with the three tables  and the two JSON strings</span>
<span class="sd">            (dict[&quot;maxDifferences.json&quot;] and dict[&quot;groupMetrics.json&quot;]). The default value is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing a key-value pair representing the files name and json</span>
<span class="sd">            dumps respectively.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If :mod:`swat` is not installed, this function cannot perform the necessary</span>
<span class="sd">            calculations.</span>

<span class="sd">        ValueError</span>
<span class="sd">            This function requires pred_values OR (regression) or prob_values AND levels (classification) to be passed.</span>

<span class="sd">            Variable names must follow SAS naming conventions (no spaces or names that begin with a number or symbol).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sess</span> <span class="o">=</span> <span class="n">current_session</span><span class="p">()</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">as_swat</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The `swat` package is required to generate fit statistics, ROC, and Lift charts with the &quot;</span>
                <span class="s2">&quot;calculate_model_statistics function.&quot;</span>
            <span class="p">)</span>

        <span class="n">variables</span> <span class="o">=</span> <span class="n">score_table</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">_check_for_invalid_variable_names</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pred_values</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">prob_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;A value for pred_values (regression) or prob_values (classification) must be passed.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># if it&#39;s a classification problem</span>
        <span class="k">if</span> <span class="n">prob_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Levels of the target variable must be passed for classification problems. The levels should be &quot;</span>
                    <span class="s2">&quot;ordered in the same way that the predicted probability variables are ordered.&quot;</span>
                <span class="p">)</span>
            <span class="n">score_table</span><span class="p">[</span><span class="n">actual_values</span><span class="p">]</span> <span class="o">=</span> <span class="n">score_table</span><span class="p">[</span><span class="n">actual_values</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sensitive_values</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">sensitive_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">sensitive_values</span><span class="p">]</span>

        <span class="c1"># upload properly formatted score table to CAS</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">score_table</span><span class="p">,</span> <span class="n">casout</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;score_table&quot;</span><span class="p">))</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">loadactionset</span><span class="p">(</span><span class="s2">&quot;fairaitools&quot;</span><span class="p">)</span>
        <span class="n">maxdiff_dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">groupmetrics_dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">biasmetrics_dfs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sensitive_values</span><span class="p">:</span>
            <span class="c1"># run assessBias, if levels=None then assessBias treats the input like a regression problem</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">fairaitools</span><span class="o">.</span><span class="n">assessbias</span><span class="p">(</span>
                <span class="n">modelTableType</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
                <span class="n">predictedVariables</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">pred_values</span> <span class="k">if</span> <span class="n">pred_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">prob_values</span>
                <span class="p">),</span>
                <span class="n">response</span><span class="o">=</span><span class="n">actual_values</span><span class="p">,</span>
                <span class="n">responseLevels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                <span class="n">sensitiveVariable</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                <span class="n">cutoff</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span>
                <span class="n">table</span><span class="o">=</span><span class="s2">&quot;score_table&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># get maxdiff table, append to list</span>
            <span class="n">maxdiff</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;MaxDifferences&quot;</span><span class="p">])</span>
            <span class="c1"># adding variable to table</span>
            <span class="n">maxdiff</span><span class="p">[</span><span class="s2">&quot;_VARIABLE_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">maxdiff_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maxdiff</span><span class="p">)</span>

            <span class="c1"># get group metrics table, append to list</span>
            <span class="n">group_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;GroupMetrics&quot;</span><span class="p">])</span>
            <span class="n">group_metrics</span><span class="p">[</span><span class="s2">&quot;_VARIABLE_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">groupmetrics_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_metrics</span><span class="p">)</span>

            <span class="c1"># get bis metrics table if they want to return it</span>
            <span class="k">if</span> <span class="n">return_dataframes</span><span class="p">:</span>
                <span class="n">bias_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;BiasMetrics&quot;</span><span class="p">])</span>
                <span class="n">bias_metrics</span><span class="p">[</span><span class="s2">&quot;_VARIABLE_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                <span class="n">biasmetrics_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bias_metrics</span><span class="p">)</span>

        <span class="c1"># overall formatting</span>
        <span class="n">group_metrics</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_group_metrics</span><span class="p">(</span>
            <span class="n">groupmetrics_dfs</span><span class="o">=</span><span class="n">groupmetrics_dfs</span><span class="p">,</span>
            <span class="n">prob_values</span><span class="o">=</span><span class="n">prob_values</span><span class="p">,</span>
            <span class="n">pred_values</span><span class="o">=</span><span class="n">pred_values</span><span class="p">,</span>
            <span class="n">datarole</span><span class="o">=</span><span class="n">datarole</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">max_differences</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_max_differences</span><span class="p">(</span>
            <span class="n">maxdiff_dfs</span><span class="o">=</span><span class="n">maxdiff_dfs</span><span class="p">,</span> <span class="n">datarole</span><span class="o">=</span><span class="n">datarole</span>
        <span class="p">)</span>

        <span class="c1"># getting json files</span>
        <span class="n">json_files</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">bias_dataframes_to_json</span><span class="p">(</span>
            <span class="n">groupmetrics</span><span class="o">=</span><span class="n">group_metrics</span><span class="p">,</span>
            <span class="n">maxdifference</span><span class="o">=</span><span class="n">max_differences</span><span class="p">,</span>
            <span class="n">n_sensitivevariables</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">sensitive_values</span><span class="p">),</span>
            <span class="n">actual_values</span><span class="o">=</span><span class="n">actual_values</span><span class="p">,</span>
            <span class="n">prob_values</span><span class="o">=</span><span class="n">prob_values</span><span class="p">,</span>
            <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
            <span class="n">pred_values</span><span class="o">=</span><span class="n">pred_values</span><span class="p">,</span>
            <span class="n">json_path</span><span class="o">=</span><span class="n">json_path</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">return_dataframes</span><span class="p">:</span>
            <span class="n">bias_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">biasmetrics_dfs</span><span class="p">)</span>
            <span class="n">df_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;maxDifferencesData&quot;</span><span class="p">:</span> <span class="n">max_differences</span><span class="p">,</span>
                <span class="s2">&quot;groupMetricsData&quot;</span><span class="p">:</span> <span class="n">group_metrics</span><span class="p">,</span>
                <span class="s2">&quot;biasMetricsData&quot;</span><span class="p">:</span> <span class="n">bias_metrics</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">json_files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">df_dict</span>

            <span class="n">json_files</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">df_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">json_files</span></div>


<div class="viewcode-block" id="JSONFiles.format_max_differences">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.format_max_differences">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">format_max_differences</span><span class="p">(</span>
        <span class="n">maxdiff_dfs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">datarole</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a list of max differences DataFrames into a singular DataFrame</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        maxdiff_dfs: list of pandas.DataFrame</span>
<span class="sd">            A list of max_differences DataFrames returned by CAS</span>
<span class="sd">        datarole : str, optional</span>
<span class="sd">            The data being used to assess bias (i.e. &#39;TEST&#39;, &#39;VALIDATION&#39;, etc.). Default is &#39;TEST.&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            A singluar DataFrame containing all max differences data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">maxdiff_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">maxdiff_dfs</span><span class="p">)</span>
        <span class="n">maxdiff_df</span> <span class="o">=</span> <span class="n">maxdiff_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;maxdiff&quot;</span><span class="p">,</span> <span class="s2">&quot;Base&quot;</span><span class="p">:</span> <span class="s2">&quot;BASE&quot;</span><span class="p">,</span> <span class="s2">&quot;Compare&quot;</span><span class="p">:</span> <span class="s2">&quot;COMPARE&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">maxdiff_df</span><span class="p">[</span><span class="s2">&quot;maxdiff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxdiff_df</span><span class="p">[</span><span class="s2">&quot;maxdiff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

        <span class="n">maxdiff_df</span><span class="p">[</span><span class="s2">&quot;VLABEL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">maxdiff_df</span><span class="p">[</span><span class="s2">&quot;_DATAROLE_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datarole</span>

        <span class="n">maxdiff_df</span> <span class="o">=</span> <span class="n">maxdiff_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">maxdiff_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">maxdiff_df</span></div>


<div class="viewcode-block" id="JSONFiles.format_group_metrics">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.format_group_metrics">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">format_group_metrics</span><span class="p">(</span>
        <span class="n">groupmetrics_dfs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">prob_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pred_values</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">datarole</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts list of group metrics DataFrames to a single DataFrame</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        groupmetrics_dfs: list of pandas.DataFrame</span>
<span class="sd">            List of group metrics DataFrames generated by CASAction</span>
<span class="sd">        pred_values : str</span>
<span class="sd">            Required for regression problems, otherwise not used.</span>
<span class="sd">            Variable name containing the predicted values in score_table. The variable name must follow SAS naming</span>
<span class="sd">            conventions (no spaces and the name cannot begin with a number or symbol).Required for regression problems.</span>
<span class="sd">            The default value is None.</span>
<span class="sd">        prob_values : list of str</span>
<span class="sd">            Required for classification problems, otherwise not used</span>
<span class="sd">            A list of variable names containing the predicted probability values in the score table. The first element</span>
<span class="sd">            should represent the predicted probability of the target class. Required for classification problems. Default</span>
<span class="sd">            is None.</span>
<span class="sd">        datarole : str, optional</span>
<span class="sd">            The data being used to assess bias (i.e. &#39;TEST&#39;, &#39;VALIDATION&#39;, etc.). Default is &#39;TEST&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            A singular DataFrame containing formatted data for group metrics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># adding group metrics dataframes and adding values/ formatting</span>
        <span class="n">groupmetrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">groupmetrics_dfs</span><span class="p">)</span>
        <span class="n">groupmetrics_df</span> <span class="o">=</span> <span class="n">groupmetrics_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Group&quot;</span><span class="p">:</span> <span class="s2">&quot;LEVEL&quot;</span><span class="p">,</span>
                <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="s2">&quot;nobs&quot;</span><span class="p">,</span>
                <span class="s2">&quot;MISCEVENT&quot;</span><span class="p">:</span> <span class="s2">&quot;misccutoff&quot;</span><span class="p">,</span>
                <span class="s2">&quot;MISCEVENTKS&quot;</span><span class="p">:</span> <span class="s2">&quot;miscks&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cutoffKS&quot;</span><span class="p">:</span> <span class="s2">&quot;kscut&quot;</span><span class="p">,</span>
                <span class="s2">&quot;PREDICTED&quot;</span><span class="p">:</span> <span class="s2">&quot;avgyhat&quot;</span><span class="p">,</span>
                <span class="s2">&quot;maxKS&quot;</span><span class="p">:</span> <span class="s2">&quot;ks&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">groupmetrics_df</span><span class="p">[</span><span class="s2">&quot;VLABEL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">groupmetrics_df</span><span class="p">[</span><span class="s2">&quot;_DATAROLE_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datarole</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">groupmetrics_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prob_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">upper_cols</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s2">&quot;LEVEL&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;_VARIABLE_&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;_DATAROLE_&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;VLABEL&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;INTO_EVENT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;PREDICTED_EVENT&quot;</span><span class="p">,</span>
                <span class="p">]</span> <span class="o">+</span> <span class="n">prob_values</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">upper_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;LEVEL&quot;</span><span class="p">,</span> <span class="s2">&quot;_VARIABLE_&quot;</span><span class="p">,</span> <span class="s2">&quot;_DATAROLE_&quot;</span><span class="p">,</span> <span class="s2">&quot;VLABEL&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                    <span class="n">pred_values</span>
                <span class="p">]</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">upper_cols</span><span class="p">:</span>
                <span class="n">groupmetrics_df</span> <span class="o">=</span> <span class="n">groupmetrics_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="p">}</span>
                <span class="p">)</span>

        <span class="n">groupmetrics_df</span> <span class="o">=</span> <span class="n">groupmetrics_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">groupmetrics_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">groupmetrics_df</span></div>


<div class="viewcode-block" id="JSONFiles.bias_dataframes_to_json">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.bias_dataframes_to_json">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@experimental</span>
    <span class="k">def</span> <span class="nf">bias_dataframes_to_json</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">groupmetrics</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">maxdifference</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_sensitivevariables</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">actual_values</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prob_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">levels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pred_values</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">json_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Properly formats data from FairAITools CAS Action Set into a JSON readable formats</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        groupmetrics: pandas.DataFrame</span>
<span class="sd">            A DataFrame containing the group metrics data</span>
<span class="sd">        maxdifference: pandas.DataFrame</span>
<span class="sd">            A DataFrame containing the max difference data</span>
<span class="sd">        n_sensitivevariables: int</span>
<span class="sd">            The total number of sensitive values</span>
<span class="sd">        actual_values : str</span>
<span class="sd">            Variable name containing the actual values in score_table. The variable name must follow SAS naming</span>
<span class="sd">            conventions (no spaces and the name cannot begin with a number or symbol).</span>
<span class="sd">        prob_values : list of str</span>
<span class="sd">            Required for classification problems, otherwise not used</span>
<span class="sd">            A list of variable names containing the predicted probability values in the score table. The first element</span>
<span class="sd">            should represent the predicted probability of the target class. Required for classification problems. Default</span>
<span class="sd">            is None.</span>
<span class="sd">        levels: list of str</span>
<span class="sd">            Required for classification problems, otherwise not used</span>
<span class="sd">            List of classes of a nominal target in the order they were passed in `prob_values`. Levels must be passed as a</span>
<span class="sd">            string. Default is None.</span>
<span class="sd">        pred_values : str</span>
<span class="sd">            Required for regression problems, otherwise not used</span>
<span class="sd">            Variable name containing the predicted values in `score_table`. The variable name must follow SAS naming</span>
<span class="sd">            conventions (no spaces and the name cannot begin with a number or symbol). Required for regression problems.</span>
<span class="sd">            The default value is None.</span>
<span class="sd">        json_path : str or pathlib.Path, optional</span>
<span class="sd">            Location for the output JSON files. If a path is passed, the json files will populate in the directory and</span>
<span class="sd">            the function will return None, unless return_dataframes is True. Otherwise, the function will return the json</span>
<span class="sd">            strings in a dictionary (dict[&quot;maxDifferences.json&quot;] and dict[&quot;groupMetrics.json&quot;]). The default value is</span>
<span class="sd">            None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing a key-value pair representing the files name and json</span>
<span class="sd">            dumps respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="s2">&quot;reg_jsons&quot;</span> <span class="k">if</span> <span class="n">prob_values</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;clf_jsons&quot;</span>

        <span class="n">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxdifference</span><span class="p">,</span> <span class="n">groupmetrics</span><span class="p">)</span>
        <span class="n">json_dict</span> <span class="o">=</span> <span class="p">[{},</span> <span class="p">{}]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;maxDifferences&quot;</span><span class="p">,</span> <span class="s2">&quot;groupMetrics&quot;</span><span class="p">]):</span>
            <span class="c1"># reading template files</span>
            <span class="n">json_template_path</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;template_files/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.json&quot;</span>
            <span class="p">)</span>
            <span class="n">json_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_json_file</span><span class="p">(</span><span class="n">json_template_path</span><span class="p">)</span>
            <span class="c1"># updating data rows</span>
            <span class="k">for</span> <span class="n">row_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="n">row_dict</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_num</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dataMap&quot;</span><span class="p">:</span> <span class="n">row_dict</span><span class="p">,</span> <span class="s2">&quot;rowNumber&quot;</span><span class="p">:</span> <span class="n">row_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span>
                <span class="n">json_dict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>

        <span class="c1"># formatting metric label for max diff</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sensitivevariables</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">prob_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">prob_label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prob_values</span><span class="p">):</span>
                    <span class="n">json_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">26</span><span class="p">)</span> <span class="o">+</span> <span class="n">j</span><span class="p">][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span>
                        <span class="s2">&quot;MetricLabel&quot;</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Average Predicted: </span><span class="si">{</span><span class="n">actual_values</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">levels</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">json_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span> <span class="o">*</span> <span class="mi">8</span><span class="p">][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span>
                    <span class="s2">&quot;MetricLabel&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Average Predicted: </span><span class="si">{</span><span class="n">actual_values</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># formatting parameter map for group metrics</span>
        <span class="k">if</span> <span class="n">prob_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prob_label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prob_values</span><span class="p">):</span>
                <span class="n">paramdict</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">prob_label</span><span class="p">,</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                    <span class="c1"># TODO: figure out order ordering</span>
                    <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="mi">34</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
                    <span class="s2">&quot;parameter&quot;</span><span class="p">:</span> <span class="n">prob_label</span><span class="p">,</span>
                    <span class="s2">&quot;preformatted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;num&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">prob_label</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="n">json_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;parameterMap&quot;</span><span class="p">][</span><span class="n">prob_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">paramdict</span>
                <span class="c1"># cls.add_dict_key(</span>
                <span class="c1">#     dict=json_dict[1][&quot;parameterMap&quot;],</span>
                <span class="c1">#     pos=i + 3,</span>
                <span class="c1">#     new_key=prob_label,</span>
                <span class="c1">#     new_value=paramdict,]</span>
                <span class="c1"># )</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">json_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;parameterMap&quot;</span><span class="p">][</span><span class="s2">&quot;predict&quot;</span><span class="p">][</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_values</span>
            <span class="n">json_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;parameterMap&quot;</span><span class="p">][</span><span class="s2">&quot;predict&quot;</span><span class="p">][</span><span class="s2">&quot;parameter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_values</span>
            <span class="n">json_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;parameterMap&quot;</span><span class="p">][</span><span class="s2">&quot;predict&quot;</span><span class="p">][</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pred_values</span><span class="p">]</span>
            <span class="n">json_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;parameterMap&quot;</span><span class="p">][</span><span class="n">pred_values</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;parameterMap&quot;</span><span class="p">][</span>
                <span class="s2">&quot;predict&quot;</span>
            <span class="p">]</span>
            <span class="k">del</span> <span class="n">json_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;parameterMap&quot;</span><span class="p">][</span><span class="s2">&quot;predict&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">json_path</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">MAXDIFFERENCES</span><span class="p">,</span> <span class="n">GROUPMETRICS</span><span class="p">]):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                    <span class="n">json_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">notebook_output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> was successfully written and saved to &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">MAXDIFFERENCES</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">),</span>
                <span class="n">GROUPMETRICS</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">),</span>
            <span class="p">}</span></div>


<div class="viewcode-block" id="JSONFiles.calculate_model_statistics">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.calculate_model_statistics">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">calculate_model_statistics</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">target_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">prob_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">validate_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;numpy.ndarray&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">train_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;numpy.ndarray&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;numpy.ndarray&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">json_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span>
        <span class="n">cutoff</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates fit statistics (including ROC and Lift curves) from datasets and then</span>
<span class="sd">        either writes them to JSON files or returns them as a single dictionary.</span>

<span class="sd">        Calculations are performed using a call to SAS CAS via the swat package. An</span>
<span class="sd">        error will be raised if the swat package is not installed or if a connection to</span>
<span class="sd">        a SAS Viya system is not possible.</span>

<span class="sd">        Datasets must contain the actual and predicted values and may optionally contain</span>
<span class="sd">        the predicted probabilities. If no probabilities are provided, a dummy</span>
<span class="sd">        probability dataset is generated based on the predicted values and normalized by</span>
<span class="sd">        the target value. If a probability threshold value is not provided, the</span>
<span class="sd">        threshold value is set at 0.5.</span>

<span class="sd">        Datasets can be provided in the following forms, with the assumption that data</span>
<span class="sd">        is ordered as `actual`, `predict`, and `probability` respectively:</span>

<span class="sd">        * pandas dataframe: the actual and predicted values are their own columns</span>
<span class="sd">        * list: the actual and predicted values are their own indexed entry</span>
<span class="sd">        * numpy array: the actual and predicted values are their own columns or rows \</span>
<span class="sd">        and ordered such that the actual values come first and the predicted second</span>

<span class="sd">        If a json_path is supplied, then this function outputs a set of JSON files named</span>
<span class="sd">        &quot;dmcas_fitstat.json&quot;, &quot;dmcas_roc.json&quot;, &quot;dmcas_lift.json&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target_value : str, int, or float</span>
<span class="sd">            Target event value for model prediction events.</span>
<span class="sd">        prob_value : int or float, optional</span>
<span class="sd">            The threshold value for model predictions to indicate an event occurred. The</span>
<span class="sd">            default value is 0.5.</span>
<span class="sd">        validate_data : pandas.DataFrame, list of list, or numpy.ndarray, optional</span>
<span class="sd">            Dataset pertaining to the validation data. The default value is None.</span>
<span class="sd">        train_data : pandas.DataFrame, list of list, or numpy.ndarray, optional</span>
<span class="sd">            Dataset pertaining to the training data. The default value is None.</span>
<span class="sd">        test_data : pandas.DataFrame, list of list, or numpy.ndarray, optional</span>
<span class="sd">            Dataset pertaining to the test data. The default value is None.</span>
<span class="sd">        json_path : str or pathlib.Path, optional</span>
<span class="sd">            Location for the output JSON files. The default value is None.</span>
<span class="sd">        target_type: str, optional</span>
<span class="sd">            Type of target the model is trying to find. Currently supports &quot;classification&quot;</span>
<span class="sd">            and &quot;prediction&quot; types. The default value is &quot;classification&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing a key-value pair representing the files name and json</span>
<span class="sd">            dumps respectively.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If swat is not installed, this function cannot perform the necessary</span>
<span class="sd">            calculations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sess</span> <span class="o">=</span> <span class="n">current_session</span><span class="p">()</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">as_swat</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The `swat` package is required to generate fit statistics, ROC, and &quot;</span>
                <span class="s2">&quot;Lift charts with the calculate_model_statistics function.&quot;</span>
            <span class="p">)</span>

        <span class="n">json_dict</span> <span class="o">=</span> <span class="p">[{},</span> <span class="p">{},</span> <span class="p">{}]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;dmcas_fitstat&quot;</span><span class="p">,</span> <span class="s2">&quot;dmcas_roc&quot;</span><span class="p">,</span> <span class="s2">&quot;dmcas_lift&quot;</span><span class="p">]):</span>
            <span class="n">json_template_path</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;template_files/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.json&quot;</span>
            <span class="p">)</span>
            <span class="n">json_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_json_file</span><span class="p">(</span><span class="n">json_template_path</span><span class="p">)</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">loadactionset</span><span class="p">(</span><span class="n">actionset</span><span class="o">=</span><span class="s2">&quot;percentile&quot;</span><span class="p">)</span>

        <span class="n">data_partition_exists</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">check_for_data</span><span class="p">(</span><span class="n">validate_data</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">partition</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">data_partition_exists</span><span class="p">,</span> <span class="p">[</span><span class="n">validate_data</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">])</span>
        <span class="p">):</span>
            <span class="c1"># If the data partition was not passed, skip to the next partition</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">partition</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">stat_dataset_to_dataframe</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target_value</span><span class="p">,</span> <span class="n">target_type</span><span class="p">)</span>

            <span class="n">conn</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">casout</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;assess_dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;caslib&quot;</span><span class="p">:</span> <span class="s2">&quot;Public&quot;</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">percentile</span><span class="o">.</span><span class="n">assess</span><span class="p">(</span>
                    <span class="n">table</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;assess_dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;caslib&quot;</span><span class="p">:</span> <span class="s2">&quot;Public&quot;</span><span class="p">},</span>
                    <span class="n">response</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">,</span>
                    <span class="n">pVar</span><span class="o">=</span><span class="s2">&quot;predict_proba&quot;</span><span class="p">,</span>
                    <span class="n">event</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">target_value</span><span class="p">),</span>
                    <span class="n">pEvent</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">prob_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">prob_value</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span>
                    <span class="n">inputs</span><span class="o">=</span><span class="s2">&quot;actual&quot;</span><span class="p">,</span>
                    <span class="n">fitStatOut</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;FitStat&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;caslib&quot;</span><span class="p">:</span> <span class="s2">&quot;Public&quot;</span><span class="p">},</span>
                    <span class="n">rocOut</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ROC&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;caslib&quot;</span><span class="p">:</span> <span class="s2">&quot;Public&quot;</span><span class="p">},</span>
                    <span class="n">casout</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Lift&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;caslib&quot;</span><span class="p">:</span> <span class="s2">&quot;Public&quot;</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">percentile</span><span class="o">.</span><span class="n">assess</span><span class="p">(</span>
                    <span class="n">table</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;assess_dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;caslib&quot;</span><span class="p">:</span> <span class="s2">&quot;Public&quot;</span><span class="p">},</span>
                    <span class="n">response</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">,</span>
                    <span class="n">inputs</span><span class="o">=</span><span class="s2">&quot;actual&quot;</span><span class="p">,</span>
                    <span class="n">fitStatOut</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;FitStat&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;caslib&quot;</span><span class="p">:</span> <span class="s2">&quot;Public&quot;</span><span class="p">},</span>
                    <span class="n">casout</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Lift&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;caslib&quot;</span><span class="p">:</span> <span class="s2">&quot;Public&quot;</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="n">fitstat_dict</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">CASTable</span><span class="p">(</span><span class="s2">&quot;FitStat&quot;</span><span class="p">,</span> <span class="n">caslib</span><span class="o">=</span><span class="s2">&quot;Public&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">())</span>
                <span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
                <span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">json_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fitstat_dict</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                <span class="n">roc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">CASTable</span><span class="p">(</span><span class="s2">&quot;ROC&quot;</span><span class="p">,</span> <span class="n">caslib</span><span class="o">=</span><span class="s2">&quot;Public&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">())</span>
                <span class="n">roc_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">apply_dataframe_to_json</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">roc_df</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">roc_dict</span><span class="p">)):</span>
                    <span class="n">json_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">roc_dict</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">fitstat_data</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">roc_dict</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span><span class="s2">&quot;_KS_&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">fitstat_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                        <span class="n">missing_stats</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;_KS_&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;_KS2_&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;_C_&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;_Gini_&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;_Gamma_&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;_Tau_&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">missing_stats</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">roc_dict</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">]:</span>
                                <span class="n">fitstat_data</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_dict</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span><span class="n">stat</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">fitstat_data</span><span class="p">:</span>
                        <span class="n">json_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fitstat_data</span><span class="p">)</span>

            <span class="n">lift_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">CASTable</span><span class="p">(</span><span class="s2">&quot;Lift&quot;</span><span class="p">,</span> <span class="n">caslib</span><span class="o">=</span><span class="s2">&quot;Public&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">())</span>
            <span class="n">lift_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">apply_dataframe_to_json</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">lift_df</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lift_dict</span><span class="p">)):</span>
                <span class="n">json_dict</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lift_dict</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">json_path</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">FITSTAT</span><span class="p">,</span> <span class="n">ROC</span><span class="p">,</span> <span class="n">LIFT</span><span class="p">]):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="n">ROC</span> <span class="ow">and</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;prediction&quot;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                        <span class="n">json_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">notebook_output</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> was successfully written and saved to &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="n">FITSTAT</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">),</span>
                    <span class="n">ROC</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">),</span>
                    <span class="n">LIFT</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="n">FITSTAT</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">),</span>
                    <span class="n">LIFT</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">),</span>
                <span class="p">}</span></div>


<div class="viewcode-block" id="JSONFiles.check_for_data">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.check_for_data">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">check_for_data</span><span class="p">(</span>
        <span class="n">validate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;numpy.ndarray&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">train</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;numpy.ndarray&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;numpy.ndarray&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check which datasets were provided and return a list of flags.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        validate : pandas.DataFrame, list of list, or numpy.ndarray, optional</span>
<span class="sd">            Dataset pertaining to the validation data. The default value is None.</span>
<span class="sd">        train : pandas.DataFrame, list of list, or numpy.ndarray, optional</span>
<span class="sd">            Dataset pertaining to the training data. The default value is None.</span>
<span class="sd">        test : pandas.DataFrame, list of list, or numpy.ndarray, optional</span>
<span class="sd">            Dataset pertaining to the test data. The default value is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data_partitions : list</span>
<span class="sd">            A list of flags indicating which partitions have datasets.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If no data is provided, raises an exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">(</span><span class="n">validate</span><span class="p">,</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No data was provided. Please provide the actual and predicted values &quot;</span>
                <span class="s2">&quot;for at least one of the partitions (VALIDATE, TRAIN, or TEST).&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_partitions</span> <span class="o">=</span> <span class="p">[</span>
                <span class="mi">1</span> <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">1</span> <span class="k">if</span> <span class="n">train</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">1</span> <span class="k">if</span> <span class="n">test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="n">data_partitions</span></div>


<div class="viewcode-block" id="JSONFiles.stat_dataset_to_dataframe">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.stat_dataset_to_dataframe">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">stat_dataset_to_dataframe</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;numpy.ndarray&quot;</span><span class="p">]],</span>
        <span class="n">target_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the user supplied statistical dataset from either a pandas DataFrame,</span>
<span class="sd">        list of lists, or numpy array to a DataFrame formatted for SAS CAS upload.</span>

<span class="sd">        If the prediction probabilities are not provided, the prediction data will be</span>
<span class="sd">        duplicated to allow for calculation of the fit statistics through CAS and then a</span>
<span class="sd">        binary filter is applied to the duplicate column based off of a provided target</span>
<span class="sd">        value. The data is assumed to be in the order of &quot;actual&quot;, &quot;predicted&quot;,</span>
<span class="sd">        &quot;probability&quot; respectively.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pandas.DataFrame, list of list, or numpy.ndarray</span>
<span class="sd">            Dataset representing the actual and predicted values of the model. May also</span>
<span class="sd">            include the prediction probabilities.</span>
<span class="sd">        target_value : str, int, or float, optional</span>
<span class="sd">            Target event value for model prediction events. Used for creating a binary</span>
<span class="sd">            probability column when no probability values are provided. The default</span>
<span class="sd">            value is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : pandas.DataFrame</span>
<span class="sd">            Dataset formatted for SAS CAS upload.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Raised if an improper data format is provided.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert target_value to numeric for creating binary probabilities</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">target_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">target_value</span><span class="p">)</span>

        <span class="c1"># Assume column order (actual, predicted, probability) per argument instructions</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;actual&quot;</span><span class="p">,</span> <span class="s2">&quot;predict&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;predict_proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;predict&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="n">target_value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;actual&quot;</span><span class="p">,</span> <span class="s2">&quot;predict&quot;</span><span class="p">,</span> <span class="s2">&quot;predict_proba&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;actual&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;predict&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
                <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;predict_proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;predict&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="n">target_value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;actual&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s2">&quot;predict&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="s2">&quot;predict_proba&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;actual&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="s2">&quot;predict&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]})</span>
                <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;predict_proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;predict&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="n">target_value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;actual&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;predict&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;predict_proba&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Please provide the data in a list of lists, dataframe, or numpy array.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="JSONFiles.apply_dataframe_to_json">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.apply_dataframe_to_json">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">apply_dataframe_to_json</span><span class="p">(</span>
        <span class="n">json_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">partition</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stat_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">is_lift</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Map the values of the ROC or Lift charts from SAS CAS to the dictionary</span>
<span class="sd">        representation of the respective json file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        json_dict : dict</span>
<span class="sd">            Dictionary representation of the ROC or Lift chart json file.</span>
<span class="sd">        partition : int</span>
<span class="sd">            Numerical representation of the data partition. Either 0, 1, or 2.</span>
<span class="sd">        stat_df : pandas.DataFrame</span>
<span class="sd">            ROC or Lift DataFrame generated from the SAS CAS percentile action set.</span>
<span class="sd">        is_lift : bool</span>
<span class="sd">            Specify whether to use logic for Lift or ROC row counting. Default value is</span>
<span class="sd">            False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        json_dict : dict</span>
<span class="sd">            Dictionary representation of the ROC or Lift chart json file, with the</span>
<span class="sd">            values from the SAS CAS percentile action set added in.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">row_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stat_df</span><span class="p">)):</span>
            <span class="n">row_dict</span> <span class="o">=</span> <span class="n">stat_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_num</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">is_lift</span><span class="p">:</span>
                <span class="n">json_dict</span><span class="p">[(</span><span class="n">row_num</span> <span class="o">+</span> <span class="n">partition</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">partition</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">stat_df</span><span class="p">)][</span>
                    <span class="s2">&quot;dataMap&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">row_dict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">json_dict</span><span class="p">[</span><span class="n">row_num</span> <span class="o">+</span> <span class="p">(</span><span class="n">partition</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">stat_df</span><span class="p">))][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">row_dict</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">json_dict</span></div>


<div class="viewcode-block" id="JSONFiles.read_json_file">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.read_json_file">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">read_json_file</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a JSON file from a given path.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str or pathlib.Path</span>
<span class="sd">            Location of the JSON file to be opened.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        json.load(jFile) : str</span>
<span class="sd">            String contents of JSON file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">jFile</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">jFile</span><span class="p">)</span></div>


<div class="viewcode-block" id="JSONFiles.format_parameter">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.format_parameter">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">format_parameter</span><span class="p">(</span><span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formats the parameter name to the JSON standard expected for dmcas_fitstat.json.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        param_name : str</span>
<span class="sd">            Name of the parameter.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Name of the parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">param_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">param_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">param_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
                <span class="n">param_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">param_name</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">param_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
                <span class="n">param_name</span> <span class="o">=</span> <span class="n">param_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>

        <span class="k">return</span> <span class="n">param_name</span></div>


<div class="viewcode-block" id="JSONFiles.convert_data_role">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.convert_data_role">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">convert_data_role</span><span class="p">(</span><span class="n">data_role</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the data role identifier from string to int or int to string.</span>

<span class="sd">        JSON file descriptors require the string, int, and formatted int. If the</span>
<span class="sd">        provided data role is not valid, defaults to TRAIN (1).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_role : str or int</span>
<span class="sd">            Identifier of the data set&#39;s role; either TRAIN, TEST, or VALIDATE, or</span>
<span class="sd">            correspondingly 1, 2, or 3.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        conversion : str or int</span>
<span class="sd">            Converted data role identifier.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_role</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_role</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">data_role</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data_role</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_role</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">conversion</span> <span class="o">=</span> <span class="s2">&quot;TRAIN&quot;</span>
            <span class="k">elif</span> <span class="n">data_role</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">conversion</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span>
            <span class="k">elif</span> <span class="n">data_role</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">conversion</span> <span class="o">=</span> <span class="s2">&quot;VALIDATE&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">conversion</span> <span class="o">=</span> <span class="s2">&quot;TRAIN&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_role</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data_role</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TRAIN&quot;</span><span class="p">:</span>
                <span class="n">conversion</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">data_role</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TEST&quot;</span><span class="p">:</span>
                <span class="n">conversion</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">data_role</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;VALIDATE&quot;</span><span class="p">:</span>
                <span class="n">conversion</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">conversion</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">conversion</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">conversion</span></div>


<div class="viewcode-block" id="JSONFiles.create_requirements_json">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.create_requirements_json">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_requirements_json</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">model_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">(),</span>
        <span class="n">output_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches the model directory for Python scripts and pickle files and</span>
<span class="sd">        determines their Python package dependencies.</span>

<span class="sd">        Found dependencies are then matched to the package version found in the</span>
<span class="sd">        current working environment. Then the package and version are written to a</span>
<span class="sd">        requirements.json file.</span>

<span class="sd">        WARNING: The methods utilized in this function can determine package</span>
<span class="sd">        dependencies from provided scripts and pickle files, but CANNOT determine the</span>
<span class="sd">        required package versions without being in the development environment which</span>
<span class="sd">        they were originally created.</span>

<span class="sd">        This function works best when run in the model development environment and is</span>
<span class="sd">        likely to throw errors if run in another environment (and/or produce</span>
<span class="sd">        incorrect package versions). In the case of using this function outside the</span>
<span class="sd">        model development environment, it is recommended to the user that they adjust</span>
<span class="sd">        the requirements.json file&#39;s package versions to match the model development</span>
<span class="sd">        environment.</span>

<span class="sd">        When provided with an output_path argument, this function outputs a JSON file</span>
<span class="sd">        named &quot;requirements.json&quot;. Otherwise, a list of dicts is returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_path : str or pathlib.Path, optional</span>
<span class="sd">            The path to a Python project, by default the current working directory.</span>
<span class="sd">        output_path : str or pathlib.Path, optional</span>
<span class="sd">            The path for the output requirements.json file. The default value is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of dict</span>
<span class="sd">            List of dictionary representations of the json file contents, split into</span>
<span class="sd">            each package and/or warning.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pickle_packages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pickle_files</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_pickle_file</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pickle_file</span> <span class="ow">in</span> <span class="n">pickle_files</span><span class="p">:</span>
            <span class="n">pickle_packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_pickle_dependencies</span><span class="p">(</span><span class="n">pickle_file</span><span class="p">))</span>

        <span class="n">code_dependencies</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_code_dependencies</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>

        <span class="n">package_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pickle_packages</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">code_dependencies</span><span class="p">)</span>
        <span class="n">package_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">_flatten</span><span class="p">(</span><span class="n">package_list</span><span class="p">))))</span>
        <span class="n">package_list</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">remove_standard_library_packages</span><span class="p">(</span><span class="n">package_list</span><span class="p">)</span>
        <span class="n">package_and_version</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_local_package_version</span><span class="p">(</span><span class="n">package_list</span><span class="p">)</span>
        <span class="c1"># Identify packages with missing versions</span>
        <span class="n">missing_package_versions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">package_and_version</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="c1"># Create a list of dicts related to each package or warning</span>
        <span class="n">json_dicts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">missing_package_versions</span><span class="p">:</span>
            <span class="n">json_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;Warning&quot;</span><span class="p">:</span> <span class="s2">&quot;The existence and/or versions for the following &quot;</span>
                    <span class="s2">&quot;packages could not be determined:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Packages&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_package_versions</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">package</span><span class="p">,</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">package_and_version</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
                <span class="n">json_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;install </span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;pip install </span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s2">==</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>  <span class="c1"># skipcq: PTC-W6004</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;requirements.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dicts</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json_dicts</span></div>


<div class="viewcode-block" id="JSONFiles.get_local_package_version">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.get_local_package_version">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_local_package_version</span><span class="p">(</span><span class="n">package_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get package_name versions from the local environment.</span>

<span class="sd">        If the package_name does not contain an attribute of &quot;__version__&quot;,</span>
<span class="sd">        &quot;version&quot;, or &quot;VERSION&quot;, no package_name version will be found.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        package_list : list of str</span>
<span class="sd">            List of Python packages.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of list of str</span>
<span class="sd">            Nested list of Python package_name names and found versions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">package_not_found_output</span><span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">package_versions</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Warning: Package </span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2"> was not found in the local &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;environment. Either </span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2"> is not a valid Python package, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;or the package is not present in this environment. The &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;requirements.json file  will include a commented out version of the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;pip installation command at the bottom of the file. Please review &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the file and verify that the package exists and input the version &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;needed. &quot;</span>
            <span class="p">)</span>
            <span class="n">package_versions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">package_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">package_versions</span>

        <span class="n">package_and_version</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">package_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">package_and_version</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">package</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">__version__</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">package_and_version</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">package</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">version</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">package_and_version</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">package</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">VERSION</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                            <span class="n">package_and_version</span> <span class="o">=</span> <span class="n">package_not_found_output</span><span class="p">(</span>
                                <span class="n">package</span><span class="p">,</span> <span class="n">package_and_version</span>
                            <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
                <span class="n">package_and_version</span> <span class="o">=</span> <span class="n">package_not_found_output</span><span class="p">(</span>
                    <span class="n">package</span><span class="p">,</span> <span class="n">package_and_version</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">package_and_version</span></div>


<div class="viewcode-block" id="JSONFiles.get_code_dependencies">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.get_code_dependencies">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_code_dependencies</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">model_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the package dependencies for all Python scripts in the provided directory</span>
<span class="sd">        path.</span>

<span class="sd">        Note that currently this functionality only works for .py files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_path : str or pathlib.Path, optional</span>
<span class="sd">            File location for the output JSON file. The default value is the current</span>
<span class="sd">            working directory.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of found package dependencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">import_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">)):</span>
            <span class="n">import_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">find_imports</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
        <span class="n">import_info</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_flatten</span><span class="p">(</span><span class="n">import_info</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">import_info</span></div>


<div class="viewcode-block" id="JSONFiles.find_imports">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.find_imports">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">find_imports</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find import calls in provided Python code path.</span>

<span class="sd">        Ignores built in Python modules.</span>

<span class="sd">        Credit: modified from https://stackoverflow.com/questions/44988487/regex-to</span>
<span class="sd">        -parse-import-statements-in-python</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path : str or pathlib.Path</span>
<span class="sd">            File location for the Python file to be parsed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            List of found package dependencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>  <span class="c1"># skipcq: PTC-W6004</span>
            <span class="n">file_text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="c1"># Parse the file to get the abstract syntax tree representation</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">file_text</span><span class="p">)</span>
            <span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Walk through each node in the ast to find import calls</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
                <span class="c1"># Determine parent module for `from * import *` calls</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ImportFrom</span><span class="p">):</span>
                    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">module</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Import</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                        <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">modules</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">modules</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Remove &#39;settings&#39; module generated for SAS Model Manager score code</span>
            <span class="n">modules</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;settings&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">modules</span></div>


<div class="viewcode-block" id="JSONFiles.get_pickle_file">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.get_pickle_file">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_pickle_file</span><span class="p">(</span><span class="n">pickle_folder</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a file path, retrieve the pickle file(s).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pickle_folder : str or pathlib.Path</span>
<span class="sd">            File location for the input pickle file. The default value is the current</span>
<span class="sd">            working directory.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of pathlib.Path</span>
<span class="sd">            A list of pickle files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">pickle_folder</span><span class="p">)</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;.pkl&quot;</span><span class="p">]</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="JSONFiles.get_pickle_dependencies">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.get_pickle_dependencies">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_pickle_dependencies</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pickle_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the pickled byte stream from a file object, serializes the pickled byte</span>
<span class="sd">        stream as a bytes object, and inspects the bytes object for all Python</span>
<span class="sd">        modules and aggregates them in a list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pickle_file : str or pathlib.Path</span>
<span class="sd">            The file where you stored pickle data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of modules obtained from the pickle stream. Duplicates are removed</span>
<span class="sd">            and Python built-in modules are removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">open_file</span><span class="p">:</span>  <span class="c1"># skipcq: PTC-W6004</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">open_file</span><span class="p">)</span>  <span class="c1"># skipcq: BAN-B301</span>
            <span class="n">dumps</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">modules</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_package_names</span><span class="p">(</span><span class="n">dumps</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modules</span></div>


<div class="viewcode-block" id="JSONFiles.get_package_names">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.get_package_names">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_package_names</span><span class="p">(</span><span class="n">stream</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a list of found `package` names from a pickle stream.</span>

<span class="sd">        In most cases, the `packages` returned by the function will be valid Python</span>
<span class="sd">        packages. A check is made in get_local_package_version to ensure that the</span>
<span class="sd">        package is in fact a valid Python package.</span>

<span class="sd">        This code has been adapted from the following stackoverflow example and</span>
<span class="sd">        utilizes the pickletools package.</span>

<span class="sd">        Credit: modified from</span>
<span class="sd">        https://stackoverflow.com/questions/64850179/inspecting-a-pickle-dump-for-dependencies</span>

<span class="sd">        More information here:</span>
<span class="sd">        https://github.com/python/cpython/blob/main/Lib/pickletools.py</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stream : bytes or str</span>
<span class="sd">            A file like object or string containing the pickle.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            List of package names found as module dependencies in the pickle file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Collect opcodes, arguments, and position values from the pickle stream</span>
        <span class="n">opcode</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pickletools</span><span class="o">.</span><span class="n">genops</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
            <span class="n">opcode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">arg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># Convert to a pandas dataframe for ease of conditional filtering</span>
        <span class="n">df_pickle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;opcode&quot;</span><span class="p">:</span> <span class="n">opcode</span><span class="p">,</span> <span class="s2">&quot;arg&quot;</span><span class="p">:</span> <span class="n">arg</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">:</span> <span class="n">pos</span><span class="p">})</span>

        <span class="c1"># For all opcodes labelled GLOBAL or STACK_GLOBAL pull out the package names</span>
        <span class="n">global_stack</span> <span class="o">=</span> <span class="n">df_pickle</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df_pickle</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="s2">&quot;GLOBAL&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df_pickle</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="s2">&quot;STACK_GLOBAL&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="c1"># From the argument column, split the string of the form `X.Y.Z` by `.` and</span>
        <span class="c1"># return only the unique `X&#39;s`</span>
        <span class="n">stack_packages</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">global_stack</span><span class="o">.</span><span class="n">arg</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># For all opcodes labelled BINUNICODE or SHORT_BINUNICODE grab the package names</span>
        <span class="n">binunicode</span> <span class="o">=</span> <span class="n">df_pickle</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df_pickle</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="s2">&quot;BINUNICODE&quot;</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">df_pickle</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="s2">&quot;SHORT_BINUNICODE&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="c1"># From the argument column, split the string by `.`, then return only unique</span>
        <span class="c1"># cells with at least one split</span>
        <span class="n">arg_binunicode</span> <span class="o">=</span> <span class="n">binunicode</span><span class="o">.</span><span class="n">arg</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">unicode_packages</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">arg_binunicode</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">arg_binunicode</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># Remove invalid `package` names from the list</span>
        <span class="n">unicode_packages</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unicode_packages</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">()]</span>

        <span class="c1"># Combine the two package lists and remove any duplicates</span>
        <span class="n">packages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">stack_packages</span> <span class="o">+</span> <span class="n">unicode_packages</span><span class="p">))</span>

        <span class="c1"># Return the package list without any None values</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">packages</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span></div>


<div class="viewcode-block" id="JSONFiles.remove_standard_library_packages">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.remove_standard_library_packages">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_standard_library_packages</span><span class="p">(</span><span class="n">package_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove any packages from the required list of installed packages that are</span>
<span class="sd">        part of the Python Standard Library.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        package_list : list of str</span>
<span class="sd">            List of all packages found that are not Python built-in packages.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            List of all packages found that are not Python built-in packages or part of</span>
<span class="sd">            the Python Standard Library.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">py10stdlib</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;_aix_support&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_heapq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lzma&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mailcap&quot;</span><span class="p">,</span>
            <span class="s2">&quot;winsound&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sre_constants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;netrc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;audioop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;xdrlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_pyio&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_gdbm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;unicodedata&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pwd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;xml&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_symtable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pkgutil&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_decimal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_compat_pickle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_frozen_importlib_external&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_signal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fcntl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wsgiref&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uu&quot;</span><span class="p">,</span>
            <span class="s2">&quot;textwrap&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_codecs_iso2022&quot;</span><span class="p">,</span>
            <span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
            <span class="s2">&quot;distutils&quot;</span><span class="p">,</span>
            <span class="s2">&quot;binascii&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="p">,</span>
            <span class="s2">&quot;reprlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cProfile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dataclasses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_sha512&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ntpath&quot;</span><span class="p">,</span>
            <span class="s2">&quot;readline&quot;</span><span class="p">,</span>
            <span class="s2">&quot;signal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_elementtree&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dis&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rlcompleter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_ssl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_sha3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_winapi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;telnetlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pyexpat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_lzma&quot;</span><span class="p">,</span>
            <span class="s2">&quot;http&quot;</span><span class="p">,</span>
            <span class="s2">&quot;poplib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tokenize&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_dbm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_io&quot;</span><span class="p">,</span>
            <span class="s2">&quot;linecache&quot;</span><span class="p">,</span>
            <span class="s2">&quot;json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;faulthandler&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hmac&quot;</span><span class="p">,</span>
            <span class="s2">&quot;aifc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_csv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_codecs_hk&quot;</span><span class="p">,</span>
            <span class="s2">&quot;selectors&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_random&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_pickle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_lsprof&quot;</span><span class="p">,</span>
            <span class="s2">&quot;turtledemo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cgitb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_sitebuiltins&quot;</span><span class="p">,</span>
            <span class="s2">&quot;binhex&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fnmatch&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sysconfig&quot;</span><span class="p">,</span>
            <span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;quopri&quot;</span><span class="p">,</span>
            <span class="s2">&quot;copyreg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_pydecimal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stringprep&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bisect&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_abc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_codecs_jp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_md5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compileall&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_threading_local&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dbm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;builtins&quot;</span><span class="p">,</span>
            <span class="s2">&quot;difflib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;imghdr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;__future__&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_statistics&quot;</span><span class="p">,</span>
            <span class="s2">&quot;getopt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;xmlrpc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_sqlite3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_sha1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;shelve&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_posixshmem&quot;</span><span class="p">,</span>
            <span class="s2">&quot;struct&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timeit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ensurepip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pathlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ctypes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_multiprocessing&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_weakrefset&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sqlite3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tracemalloc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;venv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;unittest&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_blake2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mailbox&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resource&quot;</span><span class="p">,</span>
            <span class="s2">&quot;shutil&quot;</span><span class="p">,</span>
            <span class="s2">&quot;winreg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_opcode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_codecs_tw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_operator&quot;</span><span class="p">,</span>
            <span class="s2">&quot;imp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_string&quot;</span><span class="p">,</span>
            <span class="s2">&quot;os&quot;</span><span class="p">,</span>
            <span class="s2">&quot;opcode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_zoneinfo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_posixsubprocess&quot;</span><span class="p">,</span>
            <span class="s2">&quot;copy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;symtable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;itertools&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sre_parse&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_bisect&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_imp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;re&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ast&quot;</span><span class="p">,</span>
            <span class="s2">&quot;zlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fractions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pickle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;profile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sys&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ssl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cgi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;enum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;modulefinder&quot;</span><span class="p">,</span>
            <span class="s2">&quot;py_compile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_curses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_functools&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cmath&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_crypt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;contextvars&quot;</span><span class="p">,</span>
            <span class="s2">&quot;math&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;argparse&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_frozen_importlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inspect&quot;</span><span class="p">,</span>
            <span class="s2">&quot;posix&quot;</span><span class="p">,</span>
            <span class="s2">&quot;statistics&quot;</span><span class="p">,</span>
            <span class="s2">&quot;marshal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nis&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_bz2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pipes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;socketserver&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pstats&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trace&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lib2to3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;zipapp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;runpy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sre_compile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pprint&quot;</span><span class="p">,</span>
            <span class="s2">&quot;base64&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_stat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_ast&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pdb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_markupbase&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_bootsubprocess&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_collections&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_sre&quot;</span><span class="p">,</span>
            <span class="s2">&quot;msilib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;crypt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gettext&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mimetypes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_overlapped&quot;</span><span class="p">,</span>
            <span class="s2">&quot;asyncore&quot;</span><span class="p">,</span>
            <span class="s2">&quot;zipimport&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunk&quot;</span><span class="p">,</span>
            <span class="s2">&quot;atexit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;graphlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_multibytecodec&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gzip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;io&quot;</span><span class="p">,</span>
            <span class="s2">&quot;logging&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nntplib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;genericpath&quot;</span><span class="p">,</span>
            <span class="s2">&quot;syslog&quot;</span><span class="p">,</span>
            <span class="s2">&quot;token&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_msi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;idlelib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_hashlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;threading&quot;</span><span class="p">,</span>
            <span class="s2">&quot;select&quot;</span><span class="p">,</span>
            <span class="s2">&quot;doctest&quot;</span><span class="p">,</span>
            <span class="s2">&quot;getpass&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_sha256&quot;</span><span class="p">,</span>
            <span class="s2">&quot;importlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_tracemalloc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;multiprocessing&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calendar&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_codecs_cn&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_tkinter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_uuid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;socket&quot;</span><span class="p">,</span>
            <span class="s2">&quot;antigravity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_locale&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_thread&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;this&quot;</span><span class="p">,</span>
            <span class="s2">&quot;zoneinfo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;abc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;operator&quot;</span><span class="p">,</span>
            <span class="s2">&quot;colorsys&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tabnanny&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_weakref&quot;</span><span class="p">,</span>
            <span class="s2">&quot;imaplib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;concurrent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;subprocess&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_compression&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pyclbr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tarfile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;numbers&quot;</span><span class="p">,</span>
            <span class="s2">&quot;queue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;posixpath&quot;</span><span class="p">,</span>
            <span class="s2">&quot;smtpd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;webbrowser&quot;</span><span class="p">,</span>
            <span class="s2">&quot;asynchat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;weakref&quot;</span><span class="p">,</span>
            <span class="s2">&quot;filecmp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;decimal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_py_abc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;collections&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tempfile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_collections_abc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sched&quot;</span><span class="p">,</span>
            <span class="s2">&quot;locale&quot;</span><span class="p">,</span>
            <span class="s2">&quot;secrets&quot;</span><span class="p">,</span>
            <span class="s2">&quot;msvcrt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;asyncio&quot;</span><span class="p">,</span>
            <span class="s2">&quot;array&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_codecs_kr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_scproxy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_strptime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;heapq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_socket&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sndhdr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;types&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_datetime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;shlex&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tkinter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;curses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;encodings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pickletools&quot;</span><span class="p">,</span>
            <span class="s2">&quot;html&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_codecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;codeop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_ctypes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bz2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;contextlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;platform&quot;</span><span class="p">,</span>
            <span class="s2">&quot;termios&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_asyncio&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ftplib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pydoc_data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_contextvars&quot;</span><span class="p">,</span>
            <span class="s2">&quot;codecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;traceback&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pydoc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fileinput&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ossaudiodev&quot;</span><span class="p">,</span>
            <span class="s2">&quot;urllib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;csv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sunau&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_curses_panel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wave&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mmap&quot;</span><span class="p">,</span>
            <span class="s2">&quot;warnings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;functools&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ipaddress&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nturl2path&quot;</span><span class="p">,</span>
            <span class="s2">&quot;optparse&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_queue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;turtle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;spwd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;configparser&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_warnings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bdb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_osx_support&quot;</span><span class="p">,</span>
            <span class="s2">&quot;typing&quot;</span><span class="p">,</span>
            <span class="s2">&quot;zipfile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;glob&quot;</span><span class="p">,</span>
            <span class="s2">&quot;random&quot;</span><span class="p">,</span>
            <span class="s2">&quot;smtplib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;plistlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hashlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_struct&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">package_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">package</span> <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">package_list</span> <span class="k">if</span> <span class="n">package</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">py10stdlib</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">package_list</span></div>


<div class="viewcode-block" id="JSONFiles.generate_model_card">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.generate_model_card">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">generate_model_card</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">model_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_files</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span>
        <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">train_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">train_predictions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="n">target_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;classificaiton&quot;</span><span class="p">,</span>
        <span class="n">target_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">interval_vars</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">class_vars</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">selection_statistic</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">training_table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">server</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cas-shared-default&quot;</span><span class="p">,</span>
        <span class="n">caslib</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Public&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates everything required for the model card feature within SAS Model Manager.</span>

<span class="sd">        This includes uploading the training data to CAS, updating ModelProperties.json to have</span>
<span class="sd">        some extra properties, and generating dmcas_relativeimportance.json.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_prefix : string</span>
<span class="sd">            The prefix used to name files relating to the model. This is used to provide a unique</span>
<span class="sd">            name to the training data table when it is uploaded to CAS.</span>
<span class="sd">        model_files : string, Path, or dict</span>
<span class="sd">            Either the directory location of the model files (string or Path object), or</span>
<span class="sd">            a dictionary containing the contents of all the model files.</span>
<span class="sd">        algorithm : str</span>
<span class="sd">            The name of the algorithm used to generate the model.</span>
<span class="sd">        train_data: pandas.DataFrame</span>
<span class="sd">            Training data that contains all input variables as well as the target variable.</span>
<span class="sd">        train_predictions : pandas.Series, list</span>
<span class="sd">            List of predictions made by the model on the training data.</span>
<span class="sd">        target_type : string</span>
<span class="sd">            Type of target the model is trying to find. Currently supports &quot;classification&quot; and &quot;prediction&quot; types.</span>
<span class="sd">            The default value is &quot;classification&quot;.</span>
<span class="sd">        target_value : string, int, float, optional</span>
<span class="sd">            Value the model is targeting for classification models. This argument is not needed for</span>
<span class="sd">            prediction models. The default value is None.</span>
<span class="sd">        interval_vars : list, optional</span>
<span class="sd">            A list of interval variables. The default value is an empty list.</span>
<span class="sd">        class_vars : list, optional</span>
<span class="sd">            A list of classification variables. The default value is an empty list.</span>
<span class="sd">        selection_statistic: str, optional</span>
<span class="sd">            The selection statistic chosen to score the model against other models. Classification</span>
<span class="sd">            models can take any of the following values: &quot;_RASE_&quot;, &quot;_GINI_&quot;, &quot;_GAMMA_&quot;, &quot;_MCE_&quot;,</span>
<span class="sd">            &quot;_ASE_&quot;, &quot;_MCLL_&quot;, &quot;_KS_&quot;, &quot;_KSPostCutoff_&quot;, &quot;_DIV_&quot;, &quot;_TAU_&quot;, &quot;_KSCut_&quot;, or &quot;_C_&quot;.</span>
<span class="sd">            Prediction models can take any of the following values: &quot;_ASE_&quot;, &quot;_DIV_&quot;, &quot;_RASE_&quot;, &quot;_MAE_&quot;,</span>
<span class="sd">            &quot;_RMAE_&quot;, &quot;_MSLE_&quot;, &quot;_RMSLE_&quot; The default value is &quot;_KS_&quot; for classification models and</span>
<span class="sd">            &quot;_ASE_&quot; for prediction models.</span>
<span class="sd">        server: str, optional</span>
<span class="sd">            The CAS server the training data will be stored on. The default value is &quot;cas-shared-default&quot;</span>
<span class="sd">        caslib: str, optional</span>
<span class="sd">            The caslib the training data will be stored on. The default value is &quot;Public&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_value</span> <span class="ow">and</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;For the model card data to be properly generated on a classification &quot;</span>
                <span class="s2">&quot;model, a target value is required.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">target_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="s2">&quot;prediction&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Only classification and prediction target types are currently accepted.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">selection_statistic</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                <span class="n">selection_statistic</span> <span class="o">=</span> <span class="s2">&quot;_KS_&quot;</span>
            <span class="k">elif</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;prediction&quot;</span><span class="p">:</span>
                <span class="n">selection_statistic</span> <span class="o">=</span> <span class="s2">&quot;_ASE_&quot;</span>
        <span class="k">if</span> <span class="n">selection_statistic</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">valid_params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The selection statistic must be a value generated in dmcas_fitstat.json. See &quot;</span>
                <span class="s2">&quot;the documentation for a list of valid selection statistic values.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">algorithm</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Either a given algorithm or a model is required for the model card.&quot;</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sess</span> <span class="o">=</span> <span class="n">current_session</span><span class="p">()</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">as_swat</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The `swat` package is required to generate fit statistics, ROC, and &quot;</span>
                <span class="s2">&quot;Lift charts with the calculate_model_statistics function.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Upload training table to CAS. The location of the training table is returned.</span>
        <span class="n">training_table</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">upload_training_data</span><span class="p">(</span>
            <span class="n">conn</span><span class="p">,</span> <span class="n">model_prefix</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">training_table_name</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">caslib</span>
        <span class="p">)</span>

        <span class="c1"># Generates the event percentage for Classification targets, and the event average</span>
        <span class="c1"># for prediction targets</span>
        <span class="n">update_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">generate_outcome_average</span><span class="p">(</span>
            <span class="n">train_data</span><span class="o">=</span><span class="n">train_data</span><span class="p">,</span>
            <span class="n">input_variables</span><span class="o">=</span><span class="n">interval_vars</span> <span class="o">+</span> <span class="n">class_vars</span><span class="p">,</span>
            <span class="n">target_type</span><span class="o">=</span><span class="n">target_type</span><span class="p">,</span>
            <span class="n">target_value</span><span class="o">=</span><span class="n">target_value</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Formats all new ModelProperties information into one dictionary that can be used to update the json file</span>
        <span class="n">update_dict</span><span class="p">[</span><span class="s2">&quot;trainTable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">training_table</span>
        <span class="n">update_dict</span><span class="p">[</span><span class="s2">&quot;selectionStatistic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selection_statistic</span>
        <span class="n">update_dict</span><span class="p">[</span><span class="s2">&quot;algorithm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">algorithm</span>
        <span class="n">update_dict</span><span class="p">[</span><span class="s2">&quot;selectionStatisticValue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_selection_statistic_value</span><span class="p">(</span>
            <span class="n">model_files</span><span class="p">,</span> <span class="n">selection_statistic</span>
        <span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">update_model_properties</span><span class="p">(</span><span class="n">model_files</span><span class="p">,</span> <span class="n">update_dict</span><span class="p">)</span>

        <span class="c1"># Generates dmcas_relativeimportance.json file</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">generate_variable_importance</span><span class="p">(</span>
            <span class="n">conn</span><span class="p">,</span>
            <span class="n">model_files</span><span class="p">,</span>
            <span class="n">train_data</span><span class="p">,</span>
            <span class="n">train_predictions</span><span class="p">,</span>
            <span class="n">target_type</span><span class="p">,</span>
            <span class="n">interval_vars</span><span class="p">,</span>
            <span class="n">class_vars</span><span class="p">,</span>
            <span class="n">caslib</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Generates dmcas_misc.json file</span>
        <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">generate_misc</span><span class="p">(</span><span class="n">model_files</span><span class="p">)</span></div>


<div class="viewcode-block" id="JSONFiles.upload_training_data">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.upload_training_data">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">upload_training_data</span><span class="p">(</span>
        <span class="n">conn</span><span class="p">,</span>
        <span class="n">model_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">train_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">train_data_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">server</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cas-shared-default&quot;</span><span class="p">,</span>
        <span class="n">caslib</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Public&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uploads training data to CAS server.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        conn</span>
<span class="sd">            SWAT connection. Used to connect to CAS server.</span>
<span class="sd">        model_prefix : string</span>
<span class="sd">            The prefix used to name files relating to the model. This is used to provide a unique</span>
<span class="sd">            name to the training data table when it is uploaded to CAS.</span>
<span class="sd">        train_data: pandas.DataFrame</span>
<span class="sd">            Training data that contains all input variables as well as the target variable.</span>
<span class="sd">        server: str, optional</span>
<span class="sd">            The CAS server the training data will be stored on. The default value is &quot;cas-shared-default&quot;</span>
<span class="sd">        caslib: str, optional</span>
<span class="sd">            The caslib the training data will be stored on. The default value is &quot;Public&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">        Returns a string that represents the location of the training table within CAS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Upload raw training data to caslib so that data can be analyzed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">train_data_name</span><span class="p">:</span>
            <span class="n">train_data_name</span> <span class="o">=</span> <span class="n">model_prefix</span> <span class="o">+</span> <span class="s2">&quot;_train_data&quot;</span>
        <span class="n">upload_train_data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span>
            <span class="n">train_data</span><span class="p">,</span> <span class="n">casout</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">train_data_name</span><span class="p">,</span> <span class="s2">&quot;caslib&quot;</span><span class="p">:</span> <span class="n">caslib</span><span class="p">},</span> <span class="n">promote</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">upload_train_data</span><span class="o">.</span><span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># raise RuntimeError(</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;A table with the name </span><span class="si">{</span><span class="n">train_data_name</span><span class="si">}</span><span class="s2"> already exists in the specified caslib. If this &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;is not intentional, please either rename the training data file or remove the duplicate from &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the caslib.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">server</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">caslib</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">train_data_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span></div>


<div class="viewcode-block" id="JSONFiles.generate_outcome_average">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.generate_outcome_average">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">generate_outcome_average</span><span class="p">(</span>
        <span class="n">train_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">input_variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">target_type</span><span class="p">,</span>
        <span class="n">target_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the outcome average of the training data. For prediction targets, the event average</span>
<span class="sd">        is generated. For Classification targets, the event percentage is returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        train_data: pandas.DataFrame</span>
<span class="sd">            Training data that contains all input variables as well as the target variable. If multiple</span>
<span class="sd">            non-input variables are included, the function will assume that the first non-input variable row</span>
<span class="sd">            is the output.</span>
<span class="sd">        input_variables: list</span>
<span class="sd">            A list of all input variables used by the model. Used to isolate the output variable.</span>
<span class="sd">        target_type : string</span>
<span class="sd">            Type the model is targeting. Currently supports &quot;classification&quot; and &quot;prediction&quot; types.</span>
<span class="sd">        target_value : string, int, float, optional</span>
<span class="sd">            Value the model is targeting for Classification models. This argument is not needed for</span>
<span class="sd">            prediction models. The default value is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        Returns a dictionary with a key value pair that represents the outcome average.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numbers</span>

        <span class="n">output_var</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">input_variables</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
            <span class="n">value_counts</span> <span class="o">=</span> <span class="n">output_var</span><span class="p">[</span><span class="n">output_var</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;eventPercentage&quot;</span><span class="p">:</span> <span class="n">value_counts</span><span class="p">[</span><span class="n">target_value</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">value_counts</span><span class="p">)}</span>
        <span class="k">elif</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;prediction&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">output_var</span><span class="p">[</span><span class="n">output_var</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Detected output column is not numeric. Please ensure that &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;the correct output column is being passed, and that no extra columns &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;are in front of the output column. This function assumes that the first &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;non-input column is the output column.jf&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;eventAverage&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">output_var</span><span class="p">[</span><span class="n">output_var</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_var</span><span class="p">)</span>
            <span class="p">}</span></div>


<div class="viewcode-block" id="JSONFiles.get_selection_statistic_value">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.get_selection_statistic_value">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_selection_statistic_value</span><span class="p">(</span>
        <span class="n">model_files</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span> <span class="n">selection_statistic</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_GINI_&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the value of the chosen selection statistic in dmcas_fitstat.json, which should have been</span>
<span class="sd">        generated before this function has been called.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_files : string, Path, or dict</span>
<span class="sd">            Either the directory location of the model files (string or Path object), or</span>
<span class="sd">            a dictionary containing the contents of all the model files.</span>
<span class="sd">        selection_statistic: str, optional</span>
<span class="sd">            The selection statistic chosen to score the model against other models. Can be any of the</span>
<span class="sd">            following values: &quot;_RASE_&quot;, &quot;_NObs_&quot;, &quot;_GINI_&quot;, &quot;_GAMMA_&quot;, &quot;_MCE_&quot;, &quot;_ASE_&quot;, &quot;_MCLL_&quot;,</span>
<span class="sd">            &quot;_KS_&quot;, &quot;_KSPostCutoff_&quot;, &quot;_DIV_&quot;, &quot;_TAU_&quot;, &quot;_KSCut_&quot;, or &quot;_C_&quot;. The default value is &quot;_GINI_&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">        Returns the numerical value assoicated with the chosen selection statistic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_files</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">FITSTAT</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_files</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;The dmcas_fitstat.json file must be generated before the model card data &quot;</span>
                    <span class="s2">&quot;can be generated.&quot;</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">fitstat</span> <span class="ow">in</span> <span class="n">model_files</span><span class="p">[</span><span class="n">FITSTAT</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">fitstat</span><span class="p">[</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span><span class="s2">&quot;_DataRole_&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRAIN&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">selection_statistic</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fitstat</span><span class="p">[</span><span class="s2">&quot;dataMap&quot;</span><span class="p">]</span>
                        <span class="ow">or</span> <span class="n">fitstat</span><span class="p">[</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span><span class="n">selection_statistic</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span>
                    <span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                            <span class="s2">&quot;The chosen selection statistic was not generated properly. Please ensure the value has been &quot;</span>
                            <span class="s2">&quot;properly created then try again.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="n">fitstat</span><span class="p">[</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span><span class="n">selection_statistic</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">model_files</span><span class="p">)</span> <span class="o">/</span> <span class="n">FITSTAT</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;The dmcas_fitstat.json file must be generated before the model card data &quot;</span>
                    <span class="s2">&quot;can be generated.&quot;</span>
                <span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">model_files</span><span class="p">)</span> <span class="o">/</span> <span class="n">FITSTAT</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fitstat_json</span><span class="p">:</span>
                <span class="n">fitstat_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fitstat_json</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">fitstat</span> <span class="ow">in</span> <span class="n">fitstat_dict</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">fitstat</span><span class="p">[</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span><span class="s2">&quot;_DataRole_&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRAIN&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">selection_statistic</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fitstat</span><span class="p">[</span><span class="s2">&quot;dataMap&quot;</span><span class="p">]</span>
                            <span class="ow">or</span> <span class="n">fitstat</span><span class="p">[</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span><span class="n">selection_statistic</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span>
                        <span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                                <span class="s2">&quot;The chosen selection statistic was not generated properly. Please ensure the value has been &quot;</span>
                                <span class="s2">&quot;properly created then try again.&quot;</span>
                            <span class="p">)</span>
                        <span class="k">return</span> <span class="n">fitstat</span><span class="p">[</span><span class="s2">&quot;dataMap&quot;</span><span class="p">][</span><span class="n">selection_statistic</span><span class="p">]</span></div>


<div class="viewcode-block" id="JSONFiles.update_model_properties">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.update_model_properties">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_model_properties</span><span class="p">(</span><span class="n">model_files</span><span class="p">,</span> <span class="n">update_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the ModelProperties.json file to include properties listed in the update_dict dictionary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_files : string, Path, or dict</span>
<span class="sd">            Either the directory location of the model files (string or Path object), or</span>
<span class="sd">            a dictionary containing the contents of all the model files.</span>
<span class="sd">        update_dict : dictionary</span>
<span class="sd">            A dictionary containing the key-value pairs that represent properties to be added</span>
<span class="sd">            to the ModelProperties.json file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_files</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">PROP</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_files</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;The ModelProperties.json file must be generated before the model card data &quot;</span>
                    <span class="s2">&quot;can be generated.&quot;</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">update_dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">update_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">model_files</span><span class="p">[</span><span class="n">PROP</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">update_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="mi">14</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">model_files</span><span class="p">[</span><span class="n">PROP</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">model_files</span><span class="p">)</span> <span class="o">/</span> <span class="n">PROP</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;The ModelProperties.json file must be generated before the model card data &quot;</span>
                    <span class="s2">&quot;can be generated.&quot;</span>
                <span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">model_files</span><span class="p">)</span> <span class="o">/</span> <span class="n">PROP</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">properties_json</span><span class="p">:</span>
                <span class="n">model_properties</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">properties_json</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">update_dict</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">update_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">model_properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">update_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="mi">14</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">model_properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">properties_json</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">properties_json</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">model_properties</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">properties_json</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span></div>


<div class="viewcode-block" id="JSONFiles.generate_variable_importance">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.generate_variable_importance">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">generate_variable_importance</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">conn</span><span class="p">,</span>
        <span class="n">model_files</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span>
        <span class="n">train_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">train_predictions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="n">target_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span>
        <span class="n">interval_vars</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">class_vars</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">caslib</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Public&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the dmcas_relativeimportance.json file, which is used to determine variable importance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        conn</span>
<span class="sd">            A SWAT connection used to connect to the user&#39;s CAS server</span>
<span class="sd">        model_files : string, Path, or dict</span>
<span class="sd">            Either the directory location of the model files (string or Path object), or</span>
<span class="sd">            a dictionary containing the contents of all the model files.</span>
<span class="sd">        train_data: pandas.DataFrame</span>
<span class="sd">            Training data that contains all input variables as well as the target variable.</span>
<span class="sd">        train_predictions : pandas.Series, list</span>
<span class="sd">            List of predictions made by the model on the training data.</span>
<span class="sd">        target_type : string, optional</span>
<span class="sd">            Type the model is targeting. Currently supports &quot;classification&quot; and &quot;prediction&quot; types.</span>
<span class="sd">            The default value is &quot;classification&quot;.</span>
<span class="sd">        interval_vars : list, optional</span>
<span class="sd">            A list of interval variables. The default value is an empty list.</span>
<span class="sd">        class_vars : list, optional</span>
<span class="sd">            A list of classification variables. The default value is an empty list.</span>
<span class="sd">        caslib: str, optional</span>
<span class="sd">            The caslib the training data will be stored on. The default value is &quot;Public&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Remove target variable from training data by selecting only input variable columns</span>
        <span class="n">x_train_data</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">interval_vars</span> <span class="o">+</span> <span class="n">class_vars</span><span class="p">]</span>
        <span class="c1"># Upload scored training data to run variable importance on</span>
        <span class="n">x_train_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">train_predictions</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span>
            <span class="n">x_train_data</span><span class="p">,</span>
            <span class="n">casout</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;train_data&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;caslib&quot;</span><span class="p">:</span> <span class="n">caslib</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="c1"># Load actionset necessary to generate variable importance</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">loadactionset</span><span class="p">(</span><span class="s2">&quot;dataPreprocess&quot;</span><span class="p">)</span>
        <span class="n">request_packages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;DTREE&quot;</span>
            <span class="n">treeCrit</span> <span class="o">=</span> <span class="s2">&quot;Entropy&quot;</span>
        <span class="k">elif</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;prediction&quot;</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;RTREE&quot;</span>
            <span class="n">treeCrit</span> <span class="o">=</span> <span class="s2">&quot;RSS&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The selected model type is unsupported. Currently, only models that have prediction or classification target types are supported.&quot;</span>
            <span class="p">)</span>
        <span class="n">request_packages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">interval_vars</span><span class="p">:</span>
            <span class="n">request_packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;BIN&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">var</span><span class="p">}</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">interval_vars</span><span class="p">],</span>
                    <span class="s2">&quot;targets&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Prediction&quot;</span><span class="p">}],</span>
                    <span class="s2">&quot;discretize&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                        <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;minNBins&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="s2">&quot;maxNBins&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                            <span class="s2">&quot;treeCrit&quot;</span><span class="p">:</span> <span class="n">treeCrit</span><span class="p">,</span>
                            <span class="s2">&quot;contingencyTblOpts&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;inputsMethod&quot;</span><span class="p">:</span> <span class="s2">&quot;BUCKET&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;inputsNLevels&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;overrides&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;minNObsInBin&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                                <span class="s2">&quot;binMissing&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="s2">&quot;noDataLowerUpperBound&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                    <span class="p">},</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">class_vars</span><span class="p">:</span>
            <span class="n">request_packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;BIN_NOM&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">var</span><span class="p">}</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">class_vars</span><span class="p">],</span>
                    <span class="s2">&quot;targets&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Prediction&quot;</span><span class="p">}],</span>
                    <span class="s2">&quot;catTrans&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                        <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;minNBins&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="s2">&quot;maxNBins&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                            <span class="s2">&quot;treeCrit&quot;</span><span class="p">:</span> <span class="n">treeCrit</span><span class="p">,</span>
                            <span class="s2">&quot;overrides&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;minNObsInBin&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;binMissing&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                        <span class="p">},</span>
                    <span class="p">},</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="n">var_data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">dataPreprocess</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;train_data&quot;</span><span class="p">,</span> <span class="s2">&quot;caslib&quot;</span><span class="p">:</span> <span class="n">caslib</span><span class="p">},</span>
            <span class="n">requestPackages</span><span class="o">=</span><span class="n">request_packages</span><span class="p">,</span>
            <span class="n">evaluationStats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">percentileMaxIterations</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">percentileTolerance</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">,</span>
            <span class="n">distinctCountLimit</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
            <span class="n">sasVarNameLength</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">outputTableOptions</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;inputVarPrintOrder&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="n">sasProcClient</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">var_importances</span> <span class="o">=</span> <span class="n">var_data</span><span class="p">[</span><span class="s2">&quot;VarTransInfo&quot;</span><span class="p">][[</span><span class="s2">&quot;Variable&quot;</span><span class="p">,</span> <span class="s2">&quot;RelVarImportance&quot;</span><span class="p">]]</span>
        <span class="n">var_importances</span> <span class="o">=</span> <span class="n">var_importances</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RelVarImportance&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">relative_importances</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">var_importances</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">interval_vars</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;INTERVAL&quot;</span>
            <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">class_vars</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;NOMINAL&quot;</span>
            <span class="n">relative_importances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;dataMap&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;LABEL&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;LEVEL&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span>
                        <span class="s2">&quot;ROLE&quot;</span><span class="p">:</span> <span class="s2">&quot;INPUT&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;RelativeImportance&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;RelVarImportance&quot;</span><span class="p">]),</span>
                        <span class="s2">&quot;Variable&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">],</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;rowNumber&quot;</span><span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="n">json_template_path</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;template_files/</span><span class="si">{</span><span class="n">VARIMPORTANCES</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_template_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">relative_importance_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">relative_importance_json</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relative_importances</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_files</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">model_files</span><span class="p">[</span><span class="n">VARIMPORTANCES</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="n">relative_importance_json</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">notebook_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">VARIMPORTANCES</span><span class="si">}</span><span class="s2"> was successfully written and saved to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;model files dictionary.&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">model_files</span><span class="p">)</span> <span class="o">/</span> <span class="n">VARIMPORTANCES</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">json_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">relative_importance_json</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">notebook_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">VARIMPORTANCES</span><span class="si">}</span><span class="s2"> was successfully written and saved to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">model_files</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">VARIMPORTANCES</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="JSONFiles.generate_misc">
<a class="viewcode-back" href="../../../api/pzmm/write_json_files.html#sasctl.pzmm.write_json_files.JSONFiles.generate_misc">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">generate_misc</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model_files</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the dmcas_misc.json file, which is used to determine variable importance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        conn</span>
<span class="sd">            A SWAT connection used to connect to the user&#39;s CAS server</span>
<span class="sd">        model_files : string, Path, or dict</span>
<span class="sd">            Either the directory location of the model files (string or Path object), or</span>
<span class="sd">            a dictionary containing the contents of all the model files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_files</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ROC</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_files</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;The dmcas_roc.json file must be generated before the model card data &quot;</span>
                    <span class="s2">&quot;can be generated.&quot;</span>
                <span class="p">)</span>
            <span class="n">roc_table</span> <span class="o">=</span> <span class="n">model_files</span><span class="p">[</span><span class="n">ROC</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">model_files</span><span class="p">)</span> <span class="o">/</span> <span class="n">ROC</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;The dmcas_roc.json file must be generated before the model card data &quot;</span>
                    <span class="s2">&quot;can be generated.&quot;</span>
                <span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">model_files</span><span class="p">)</span> <span class="o">/</span> <span class="n">ROC</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">roc_file</span><span class="p">:</span>
                <span class="n">roc_table</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">roc_file</span><span class="p">)</span>
        <span class="n">correct_text</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CORRECT&quot;</span><span class="p">,</span> <span class="s2">&quot;INCORRECT&quot;</span><span class="p">,</span> <span class="s2">&quot;CORRECT&quot;</span><span class="p">,</span> <span class="s2">&quot;INCORRECT&quot;</span><span class="p">]</span>
        <span class="n">outcome_values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">]</span>
        <span class="n">target_texts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="s2">&quot;NEvent&quot;</span><span class="p">,</span> <span class="s2">&quot;NEvent&quot;</span><span class="p">]</span>
        <span class="n">target_values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">]</span>

        <span class="n">misc_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="c1"># Iterates through ROC table to get TRAIN, TEST, and VALIDATE data with a cutoff of .5</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
            <span class="n">roc_data</span> <span class="o">=</span> <span class="n">roc_table</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;dataMap&quot;</span><span class="p">]</span>
            <span class="n">correctness_values</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">roc_data</span><span class="p">[</span><span class="s2">&quot;_TP_&quot;</span><span class="p">],</span>
                <span class="n">roc_data</span><span class="p">[</span><span class="s2">&quot;_FP_&quot;</span><span class="p">],</span>
                <span class="n">roc_data</span><span class="p">[</span><span class="s2">&quot;_TN_&quot;</span><span class="p">],</span>
                <span class="n">roc_data</span><span class="p">[</span><span class="s2">&quot;_FN_&quot;</span><span class="p">],</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">c_text</span><span class="p">,</span> <span class="n">c_val</span><span class="p">,</span> <span class="n">o_val</span><span class="p">,</span> <span class="n">t_txt</span><span class="p">,</span> <span class="n">t_val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">correct_text</span><span class="p">,</span>
                <span class="n">correctness_values</span><span class="p">,</span>
                <span class="n">outcome_values</span><span class="p">,</span>
                <span class="n">target_texts</span><span class="p">,</span>
                <span class="n">target_values</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">misc_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;dataMap&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;CorrectText&quot;</span><span class="p">:</span> <span class="n">c_text</span><span class="p">,</span>
                            <span class="s2">&quot;Outcome&quot;</span><span class="p">:</span> <span class="n">o_val</span><span class="p">,</span>
                            <span class="s2">&quot;_Count_&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;_DataRole_&quot;</span><span class="p">:</span> <span class="n">roc_data</span><span class="p">[</span><span class="s2">&quot;_DataRole_&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;_cutoffSource_&quot;</span><span class="p">:</span> <span class="s2">&quot;Default&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;_cutoff_&quot;</span><span class="p">:</span> <span class="s2">&quot;0.5&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;TargetText&quot;</span><span class="p">:</span> <span class="n">t_txt</span><span class="p">,</span>
                            <span class="s2">&quot;Target&quot;</span><span class="p">:</span> <span class="n">t_val</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;rowNumber&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">misc_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="n">json_template_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;template_files/</span><span class="si">{</span><span class="n">MISC</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_template_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">misc_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">misc_json</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">misc_data</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_files</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">model_files</span><span class="p">[</span><span class="n">MISC</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">misc_json</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">notebook_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MISC</span><span class="si">}</span><span class="s2"> was successfully written and saved to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;model files dictionary.&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">model_files</span><span class="p">)</span> <span class="o">/</span> <span class="n">MISC</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">json_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">misc_json</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">notebook_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MISC</span><span class="si">}</span><span class="s2"> was successfully written and saved to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">model_files</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">MISC</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span></div>
</div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright Copyright © 2019, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>