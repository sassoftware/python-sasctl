
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" data-theme="dark">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sasctl.pzmm.write_score_code &#8212; sasctl 1.10.6 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "dark";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "dark";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sasctl.css?v=6840086e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=f7627286"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/sasctl/pzmm/write_score_code';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Aug 26, 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="dark">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">sasctl 1.10.6 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api/sasctl.html">
    sasctl package
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/sassoftware/python-sasctl" title="sasctl" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../../_static/sas_logo.svg" class="icon-link-image" alt="sasctl"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api/sasctl.html">
    sasctl package
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/sassoftware/python-sasctl" title="sasctl" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../../_static/sas_logo.svg" class="icon-link-image" alt="sasctl"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">sasctl.pzmm....</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for sasctl.pzmm.write_score_code</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2020, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.</span>
<span class="c1"># SPDX-License-Identifier: Apache-2.0</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>

<span class="kn">from</span> <span class="nn">.._services.model_repository</span> <span class="kn">import</span> <span class="n">ModelRepository</span> <span class="k">as</span> <span class="n">mr</span>
<span class="kn">from</span> <span class="nn">..core</span> <span class="kn">import</span> <span class="n">RestObj</span><span class="p">,</span> <span class="n">current_session</span>

<span class="n">MAS_CODE_NAME</span> <span class="o">=</span> <span class="s2">&quot;dmcas_packagescorecode.sas&quot;</span>
<span class="n">CAS_CODE_NAME</span> <span class="o">=</span> <span class="s2">&quot;dmcas_epscorecode.sas&quot;</span>


<div class="viewcode-block" id="ScoreCode">
<a class="viewcode-back" href="../../../api/pzmm/write_score_code.html#sasctl.pzmm.write_score_code.ScoreCode">[docs]</a>
<span class="k">class</span> <span class="nc">ScoreCode</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<div class="viewcode-block" id="ScoreCode.write_score_code">
<a class="viewcode-back" href="../../../api/pzmm/write_score_code.html#sasctl.pzmm.write_score_code.ScoreCode.write_score_code">[docs]</a>
    <span class="k">def</span> <span class="nf">write_score_code</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]],</span>
        <span class="n">predict_method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">List</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
        <span class="n">target_variable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">score_metrics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">predict_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">RestObj</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pickle_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pickle&quot;</span><span class="p">,</span>
        <span class="n">missing_values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">score_cas</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">score_code_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates Python score code based on training data used to create the model</span>
<span class="sd">        object.</span>

<span class="sd">        If a score_code_path argument is included, then a Python file is written to disk</span>
<span class="sd">        and can be included in the zip archive that is imported or registered into the</span>
<span class="sd">        common model repository. If no path is provided, then a dictionary is returned</span>
<span class="sd">        with the relevant score code files as strings.</span>

<span class="sd">        The following files are generated by this function if score_code_path:</span>

<span class="sd">        - &#39;*_score.py&#39;</span>
<span class="sd">            - The Python score code file for the model.</span>
<span class="sd">        - &#39;dcmas_epscorecode.sas&#39; (for SAS Viya 3.5 models)</span>
<span class="sd">            - Python score code wrapped in DS2 and prepared for CAS scoring or</span>
<span class="sd">              publishing.</span>
<span class="sd">        - &#39;dmcas_packagescorecode.sas&#39; (for SAS Viya 3.5 models)</span>
<span class="sd">            - Python score code wrapped in DS2 and prepared for SAS Microanalytic Score</span>
<span class="sd">              scoring or publishing.</span>

<span class="sd">        The function determines the type of model based on the following arguments:</span>
<span class="sd">        output_variables, target_values, predict_threshold. As an example, consider the</span>
<span class="sd">        popular iris dataset, in which the input dataset contains a number of flower</span>
<span class="sd">        features and their numerical values.</span>

<span class="sd">        For a binary classification model, where the model is determining if a flower is</span>
<span class="sd">        or is not the `setosa` species, the following can be passed:</span>
<span class="sd">            - score_metrics = [&quot;Setosa&quot;] or [&quot;Setosa&quot;, &quot;Setosa_Proba&quot;],</span>
<span class="sd">            - target_values = [&quot;1&quot;, &quot;0&quot;],</span>
<span class="sd">            - predict_threshold = [&quot;0.4&quot;]</span>

<span class="sd">        For a multi-classification model, where the model is determining if a flower is</span>
<span class="sd">        one of three species, the following can be passed:</span>
<span class="sd">            - score_metrics = [&quot;Species&quot;] or [&quot;Species&quot;, &quot;Setosa_Proba&quot;,</span>
<span class="sd">              &quot;Versicolor_Proba&quot;, &quot;Virginica_Proba&quot;]</span>
<span class="sd">            - target_values = [&quot;Setosa&quot;, &quot;Versicolor&quot;, &quot;Virginica&quot;]</span>
<span class="sd">            - predict_threshold = None</span>

<span class="sd">        Disclaimer: The score code that is generated is designed to be a working</span>
<span class="sd">        template for any Python model, but is not guaranteed to work out of the box for</span>
<span class="sd">        scoring, publishing, or validating the model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_prefix : str</span>
<span class="sd">            The variable for the model name that is used when naming model files.</span>
<span class="sd">            (For example: hmeqClassTree + [Score.py || .pickle]).</span>
<span class="sd">        input_data : DataFrame or list of dict</span>
<span class="sd">            The `DataFrame` object contains the training data, and includes only the</span>
<span class="sd">            predictor columns. The write_score_code function currently supports int(64),</span>
<span class="sd">            float(64), and string data types for scoring. Providing a list of dict</span>
<span class="sd">            objects signals that the model files are being created from an MLFlow model.</span>
<span class="sd">        predict_method : [function -&gt; list, list]</span>
<span class="sd">            The Python function used for model predictions and the expected output</span>
<span class="sd">            types. The expected output types can be passed as example values or as the</span>
<span class="sd">            value types. For example, if the model is a Scikit-Learn</span>
<span class="sd">            DecisionTreeClassifier, then pass either of the following:</span>
<span class="sd">                * [sklearn.tree.DecisionTreeClassifier.predict, [&quot;A&quot;]]</span>
<span class="sd">                * [sklearn.tree.DecisionTreeClassifier.predict_proba, [0.4, float]]</span>
<span class="sd">        target_variable : str, optional</span>
<span class="sd">            Target variable to be predicted by the model. The default value is None.</span>
<span class="sd">        target_values : list of str, optional</span>
<span class="sd">            A list of target values for the target variable. The default value is None.</span>
<span class="sd">        score_metrics : list of str, optional</span>
<span class="sd">            The scoring metrics for the model. For classification models, it is</span>
<span class="sd">            assumed that the first value in the list represents the classification</span>
<span class="sd">            output. This function supports single- and multi- classification models as</span>
<span class="sd">            well as prediction models. The default value is None.</span>
<span class="sd">        predict_threshold : float, optional</span>
<span class="sd">            The prediction threshold for normalized probability output_variables. Values</span>
<span class="sd">            are expected to be between 0 and 1. The default value is None.</span>
<span class="sd">        model : str, dict, or RestObj, optional</span>
<span class="sd">            The name or id of the model, or a dictionary representation of</span>
<span class="sd">            the model. The default value is None and is only necessary for models that</span>
<span class="sd">            will be hosted on SAS Viya 3.5.</span>
<span class="sd">        pickle_type : str, optional</span>
<span class="sd">            Indicator for the package used to serialize the model file to be uploaded to</span>
<span class="sd">            SAS Model Manager. The default value is `pickle`.</span>
<span class="sd">        missing_values : bool, list, or dict, optional</span>
<span class="sd">            Sets whether data handled by the score code will impute for missing values.</span>
<span class="sd">            If set to True, then the function determines the imputed values based on the</span>
<span class="sd">            input_data argument. In order to set the imputation values, pass a dict with</span>
<span class="sd">            variable and value key-value pairs or a list of values in the same variable</span>
<span class="sd">            order as the input_data argument. The default value is False.</span>
<span class="sd">        score_cas : bool, optional</span>
<span class="sd">            Sets whether models registered to SAS Viya 3.5 should be able to be scored</span>
<span class="sd">            and validated through both CAS and SAS Micro Analytic Service. If set to</span>
<span class="sd">            false, then the model will only be able to be scored and validated through</span>
<span class="sd">            SAS Micro Analytic Service. The default value is True.</span>
<span class="sd">        score_code_path : str or Path, optional</span>
<span class="sd">            Path for output score code file(s) to be generated. If no value is supplied</span>
<span class="sd">            a dict is returned instead. The default value is None.</span>
<span class="sd">        target_index : int, optional</span>
<span class="sd">            Sets the index of success for a binary model. If target_values are given, this</span>
<span class="sd">            index should match the index of the target outcome in target_values. If target_values</span>
<span class="sd">            are not given, this index should indicate whether the the target probability variable</span>
<span class="sd">            is the first or second variable returned by the model. The default value is 1.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Other keyword arguments are passed to one of the following functions:</span>
<span class="sd">            * sasctl.pzmm.ScoreCode._write_imports(pickle_type, mojo_model=None,</span>
<span class="sd">              binary_h2o_model=None, binary_string=None)</span>
<span class="sd">            * sasctl.pzmm.ScoreCode._viya35_model_load(model_id, pickle_type,</span>
<span class="sd">              model_file_name, mojo_model=None, binary_h2o_model=None)</span>
<span class="sd">            * sasctl.pzmm.ScoreCode._viya4_model_load(pickle_type, model_file_name,</span>
<span class="sd">              mojo_model=None, binary_h2o_model=None)</span>
<span class="sd">            * sasctl.pzmm.ScoreCode._predict_method(predict_method, input_var_list,</span>
<span class="sd">              dtype_list=None, statsmodels_model=None)</span>
<span class="sd">            * sasctl.pzmm.ScoreCode._predictions_to_metrics(output_variables,</span>
<span class="sd">              target_values=None, predict_threshold=None, h2o_model=None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract the variable names and types from the input data</span>
        <span class="n">input_var_list</span><span class="p">,</span> <span class="n">input_dtypes_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_var_lists</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>

        <span class="n">model_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_viya_version</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="n">sanitized_model_prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_model_prefix</span><span class="p">(</span><span class="n">model_prefix</span><span class="p">)</span>

        <span class="c1"># Set the model_file_name based on kwargs input</span>
        <span class="k">if</span> <span class="s2">&quot;model_file_name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s2">&quot;binary_string&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Please specify either the binary_string or the model_file_name &quot;</span>
                <span class="s2">&quot;argument. This function does not support a binary string model and a &quot;</span>
                <span class="s2">&quot;serialized model file within the same model.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;model_file_name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">model_file_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;model_file_name&quot;</span><span class="p">]</span>
            <span class="n">binary_string</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="s2">&quot;binary_string&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">model_file_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">binary_string</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;binary_string&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Either the binary_string or the model_file_name argument needs to be&quot;</span>
                <span class="s2">&quot; specified in order to generate the score code.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Add the core imports to the score code with the specified model serializer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_imports</span><span class="p">(</span>
            <span class="n">pickle_type</span><span class="p">,</span>
            <span class="n">mojo_model</span><span class="o">=</span><span class="s2">&quot;mojo_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span>
            <span class="n">binary_h2o_model</span><span class="o">=</span><span class="s2">&quot;binary_h2o_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span>
            <span class="n">tf_model</span><span class="o">=</span><span class="s2">&quot;tf_keras_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s2">&quot;tf_core_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span>
            <span class="n">binary_string</span><span class="o">=</span><span class="n">binary_string</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Generate model loading code for SAS Viya 3.5 models without binary strings</span>
        <span class="k">if</span> <span class="n">model_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">binary_string</span><span class="p">:</span>
            <span class="n">model_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viya35_model_load</span><span class="p">(</span>
                <span class="n">model_id</span><span class="p">,</span>
                <span class="n">model_file_name</span><span class="p">,</span>
                <span class="n">pickle_type</span><span class="o">=</span><span class="n">pickle_type</span><span class="p">,</span>
                <span class="n">mojo_model</span><span class="o">=</span><span class="s2">&quot;mojo_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span>
                <span class="n">binary_h2o_model</span><span class="o">=</span><span class="s2">&quot;binary_h2o_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># As above, but for SAS Viya 4 models</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">binary_string</span><span class="p">:</span>
            <span class="n">model_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viya4_model_load</span><span class="p">(</span>
                <span class="n">model_file_name</span><span class="p">,</span>
                <span class="n">pickle_type</span><span class="o">=</span><span class="n">pickle_type</span><span class="p">,</span>
                <span class="n">mojo_model</span><span class="o">=</span><span class="s2">&quot;mojo_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span>
                <span class="n">binary_h2o_model</span><span class="o">=</span><span class="s2">&quot;binary_h2o_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span>
                <span class="n">tf_keras_model</span><span class="o">=</span><span class="s2">&quot;tf_keras_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span>
                <span class="n">tf_core_model</span><span class="o">=</span><span class="s2">&quot;tf_core_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model_load</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Define the score function using the variables found in input_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;def score(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_var_list</span><span class="p">)</span><span class="si">}</span><span class="s2">):</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">def score(var1, var2, var3, var4):</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">score_metrics</span><span class="p">:</span>
            <span class="n">score_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_score_metrics</span><span class="p">(</span>
                <span class="n">predict_method</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target_variable</span><span class="p">,</span> <span class="n">target_values</span>
            <span class="p">)</span>
        <span class="c1"># Set the output variables in the line below from score_metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">Output: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">score_metrics</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;\n\n</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;Output: classification_variable, prediction_variable&quot;</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Run a try/except block to catch errors for model loading (skip binary string)</span>
        <span class="k">if</span> <span class="n">model_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">try:</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">global model</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;except NameError:</span><span class="se">\n</span><span class="si">{</span><span class="n">model_load</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    try:</span>
<span class="sd">        global model</span>
<span class="sd">    except NameError:</span>
<span class="sd">        with open(settings.pickle_path + &quot;model.pickle&quot;, &quot;rb&quot;) as pickle_file:</span>
<span class="sd">            model = pickle.load(pickle_file)</span>
<span class="sd">            &quot;&quot;&quot;</span>

        <span class="c1"># Create the appropriate style of input array and write out the predict method</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mojo_model&quot;</span><span class="p">,</span> <span class="s2">&quot;binary_h2o_model&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_predict_method</span><span class="p">(</span>
                <span class="n">predict_method</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">input_var_list</span><span class="p">,</span>
                <span class="n">missing_values</span><span class="o">=</span><span class="n">missing_values</span><span class="p">,</span>
                <span class="n">dtype_list</span><span class="o">=</span><span class="n">input_dtypes_list</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_to_metrics</span><span class="p">(</span>
                <span class="n">score_metrics</span><span class="p">,</span>
                <span class="n">predict_method</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">target_values</span><span class="o">=</span><span class="n">target_values</span><span class="p">,</span>
                <span class="n">predict_threshold</span><span class="o">=</span><span class="n">predict_threshold</span><span class="p">,</span>
                <span class="n">target_index</span><span class="o">=</span><span class="n">target_index</span><span class="p">,</span>
                <span class="n">h2o_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_predict_method</span><span class="p">(</span>
                <span class="n">predict_method</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">input_var_list</span><span class="p">,</span>
                <span class="n">missing_values</span><span class="o">=</span><span class="n">missing_values</span><span class="p">,</span>
                <span class="n">statsmodels_model</span><span class="o">=</span><span class="s2">&quot;statsmodels_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span>
                <span class="n">tf_model</span><span class="o">=</span><span class="s2">&quot;tf_keras_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s2">&quot;tf_core_model&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Include check for numpy values and a conversion operation as needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2"># Check for numpy values and convert to a CAS readable &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;representation</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if isinstance(prediction, np.ndarray):</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">prediction = prediction.tolist()</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    # Check for numpy values and conver to a CAS readable representation</span>
<span class="sd">    if isinstance(prediction, np.ndarray):</span>
<span class="sd">        prediction = prediction.tolist()</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_to_metrics</span><span class="p">(</span>
                <span class="n">score_metrics</span><span class="p">,</span>
                <span class="n">predict_method</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">target_values</span><span class="o">=</span><span class="n">target_values</span><span class="p">,</span>
                <span class="n">predict_threshold</span><span class="o">=</span><span class="n">predict_threshold</span><span class="p">,</span>
                <span class="n">target_index</span><span class="o">=</span><span class="n">target_index</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">missing_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_impute_missing_values</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">missing_values</span><span class="p">)</span>

        <span class="c1"># SAS Viya 3.5 model</span>
        <span class="k">if</span> <span class="n">model_id</span><span class="p">:</span>
            <span class="n">mas_code</span><span class="p">,</span> <span class="n">cas_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viya35_score_code_import</span><span class="p">(</span>
                <span class="n">model_prefix</span><span class="p">,</span> <span class="n">model_id</span><span class="p">,</span> <span class="n">score_cas</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">score_code_path</span><span class="p">:</span>
            <span class="n">py_code_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">score_code_path</span><span class="p">)</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;score_</span><span class="si">{</span><span class="n">sanitized_model_prefix</span><span class="si">}</span><span class="s2">.py&quot;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">py_code_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">py_file</span><span class="p">:</span>
                <span class="n">py_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score_code</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">model_id</span> <span class="ow">and</span> <span class="n">score_cas</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">score_code_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">MAS_CODE_NAME</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sas_file</span><span class="p">:</span>
                    <span class="c1"># noinspection PyUnboundLocalVariable</span>
                    <span class="n">sas_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mas_code</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">score_code_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">CAS_CODE_NAME</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sas_file</span><span class="p">:</span>
                    <span class="c1"># noinspection PyUnboundLocalVariable</span>
                    <span class="n">sas_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cas_code</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;score_</span><span class="si">{</span><span class="n">sanitized_model_prefix</span><span class="si">}</span><span class="s2">.py&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">model_id</span> <span class="ow">and</span> <span class="n">score_cas</span><span class="p">:</span>
                <span class="c1"># noinspection PyUnboundLocalVariable</span>
                <span class="n">output_dict</span><span class="p">[</span><span class="n">MAS_CODE_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">mas_code</span>
                <span class="c1"># noinspection PyUnboundLocalVariable</span>
                <span class="n">output_dict</span><span class="p">[</span><span class="n">CAS_CODE_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">cas_code</span>
            <span class="k">return</span> <span class="n">output_dict</span></div>


<div class="viewcode-block" id="ScoreCode.upload_and_copy_score_resources">
<a class="viewcode-back" href="../../../api/pzmm/write_score_code.html#sasctl.pzmm.write_score_code.ScoreCode.upload_and_copy_score_resources">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">upload_and_copy_score_resources</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">RestObj</span><span class="p">],</span> <span class="n">files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RestObj</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload score resources to SAS Model Manager and copy them to the Compute server.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : str, dict, or RestObj</span>
<span class="sd">            The name or id of the model, or a dictionary representation of the model.</span>
<span class="sd">        files : list of file objects</span>
<span class="sd">            The list of score resource files to upload.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RestObj</span>
<span class="sd">            API response to the call to copy resources to the Compute server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">mr</span><span class="o">.</span><span class="n">add_model_content</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">file</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mr</span><span class="o">.</span><span class="n">copy_python_resources</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_model_id</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">RestObj</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the model uuid from SAS Model Manager.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : str, dict, or RestObj</span>
<span class="sd">            The name or id of the model, or a dictionary representation of the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        model_id : str</span>
<span class="sd">            UUID representation of the model from SAS Model Manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No model identification was provided. Python score code&quot;</span>
                <span class="s2">&quot; generation for SAS Viya 3.5 requires the model&#39;s UUID.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model_response</span> <span class="o">=</span> <span class="n">mr</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">model_id</span> <span class="o">=</span> <span class="n">model_response</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;No model could be found using the model argument provided.&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">model_id</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_for_invalid_variable_names</span><span class="p">(</span><span class="n">var_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check for invalid variable names in the input dataset.</span>

<span class="sd">        Input data predictors must be valid Python variable names in order for the score</span>
<span class="sd">        code to be executed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var_list : list of str</span>
<span class="sd">            A list of strings pulled from the input dataset.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        SyntaxError</span>
<span class="sd">            If an invalid variable name is supplied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">invalid_variables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">var_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">():</span>
                <span class="n">invalid_variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid_variables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The following are not valid variable names: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid_variables</span><span class="p">)</span><span class="si">}</span><span class="s2">. Please confirm that all variable &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;names can be used as Python variables. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;E.g. `str(name).isidentifier() == True`.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_imports</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pickle_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mojo_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">binary_h2o_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">tf_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">binary_string</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the import section of the Python score code.</span>

<span class="sd">        The session connection to SAS Viya is utilized to determine if the settings</span>
<span class="sd">        package used solely in SAS Viya 4 is needed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pickle_type : str, optional</span>
<span class="sd">            Indicator for the package used to serialize the model file to be uploaded to</span>
<span class="sd">            SAS Model Manager. The default value is `pickle`.</span>
<span class="sd">        mojo_model : bool, optional</span>
<span class="sd">            Flag to indicate that the model is a H2O.ai MOJO model. The default value is</span>
<span class="sd">            None.</span>
<span class="sd">        binary_h2o_model : bool, optional</span>
<span class="sd">            Flag to indicate that the model is a H2O.ai binary model. The default value</span>
<span class="sd">            is None.</span>
<span class="sd">        tf_model : bool, optional</span>
<span class="sd">            Flag to indicate that the model is a tensorflow model. The default value</span>
<span class="sd">            is None.</span>
<span class="sd">        binary_string : str, optional</span>
<span class="sd">            A binary representation of the Python model object. The default value is</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pickle_type</span> <span class="o">=</span> <span class="n">pickle_type</span> <span class="k">if</span> <span class="n">pickle_type</span> <span class="k">else</span> <span class="s2">&quot;pickle&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;import math</span><span class="se">\n</span><span class="s2">import </span><span class="si">{</span><span class="n">pickle_type</span><span class="si">}</span><span class="se">\n</span><span class="s2">import pandas as pd</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;import numpy as np</span><span class="se">\n</span><span class="s2">from pathlib import Path</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">import math</span>
<span class="sd">import pickle</span>
<span class="sd">import pandas as pd</span>
<span class="sd">import numpy as np</span>
<span class="sd">from pathlib import Path</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_session</span><span class="p">()</span><span class="o">.</span><span class="n">version_info</span><span class="p">()</span> <span class="o">!=</span> <span class="mf">3.5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="s2">&quot;import settings</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">import settings</span>
<span class="sd">                </span>
<span class="sd">                </span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;No current session connection was found to a SAS Viya server. Score &quot;</span>
                <span class="s2">&quot;code will be written under the assumption that the target server is &quot;</span>
                <span class="s2">&quot;SAS Viya 4.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">mojo_model</span> <span class="ow">or</span> <span class="n">binary_h2o_model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="s2">&quot;import h2o</span><span class="se">\n\n</span><span class="s2">h2o.init()</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">import h2o</span>

<span class="sd">h2o.init()</span>

<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">elif</span> <span class="n">tf_model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="s2">&quot;import tensorflow as tf</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">import tensorflow as tf</span>

<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">elif</span> <span class="n">binary_string</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;import codecs</span><span class="se">\n\n</span><span class="s1">binary_string = &quot;</span><span class="si">{</span><span class="n">binary_string</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">model = </span><span class="si">{</span><span class="n">pickle_type</span><span class="si">}</span><span class="s2">.loads(codecs.decode(binary_string&quot;</span>
                <span class="s1">&#39;.encode(), &quot;base64&quot;))</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">import codecs</span>

<span class="sd">binary_string = &quot;&lt;binary string&gt;&quot;</span>
<span class="sd">model = pickle.load(codecs.decode(binary_string.encode(), &quot;base64&quot;))</span>
<span class="sd">            &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_viya35_model_load</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pickle_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mojo_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">binary_h2o_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the model load section of the score code assuming the model is being</span>
<span class="sd">        uploaded to SAS Viya 3.5.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_id : str</span>
<span class="sd">            UUID representation of the model from SAS Model Manager.</span>
<span class="sd">        model_file_name : str</span>
<span class="sd">            Name of the model file that contains the model.</span>
<span class="sd">        pickle_type : str, optional</span>
<span class="sd">            Indicator for the package used to serialize the model file to be uploaded to</span>
<span class="sd">            SAS Model Manager. The default value is `pickle`.</span>
<span class="sd">        mojo_model : bool, optional</span>
<span class="sd">            Flag to indicate that the model is a H2O.ai MOJO model. The default value is</span>
<span class="sd">            None.</span>
<span class="sd">        binary_h2o_model : bool, optional</span>
<span class="sd">            Flag to indicate that the model is a H2O.ai binary model. The default value</span>
<span class="sd">            is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Preformatted string for the next section of score code.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pickle_type</span> <span class="o">=</span> <span class="n">pickle_type</span> <span class="k">if</span> <span class="n">pickle_type</span> <span class="k">else</span> <span class="s2">&quot;pickle&quot;</span>

        <span class="k">if</span> <span class="n">mojo_model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;model = h2o.import_mojo(str(Path(&quot;</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;/models/resources/viya/</span><span class="si">{</span><span class="n">model_id</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="s1">&quot;)))</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">model = h2o.import_mojo(str(Path(&quot;/models/resources/viya/&lt;UUID&gt;/model.mojo&quot;)))</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">model = h2o.import_mojo(str(Path(&quot;</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;/models/resources/viya/</span><span class="si">{</span><span class="n">model_id</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="s1">&quot;)))&#39;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">binary_h2o_model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;model = h2o.load(str(Path(&quot;/models/resources/viya/&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model_id</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="s1">&quot;)))</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">model = h2o.load(str(Path(&quot;/models/resources/viya/&lt;UUID&gt;/model.h2o&quot;)))</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">model = h2o.load(str(Path(</span><span class="se">\&quot;</span><span class="s2">/models/resources/viya/&quot;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model_id</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="s1">&quot;)))&#39;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;model_path = Path(&quot;/models/resources/viya/</span><span class="si">{</span><span class="n">model_id</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;)</span><span class="se">\n</span><span class="s1">with open(model_path / &quot;</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="s1">&quot;, &#39;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">rb</span><span class="se">\&quot;</span><span class="s2">) as pickle_model:</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">model = </span><span class="si">{</span><span class="n">pickle_type</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;.load(pickle_model)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">model_path = Path(&quot;/models/resources/viya/&lt;UUID&gt;&quot;)</span>
<span class="sd">with open(model_path / &quot;model.pickle&quot;, &quot;rb&quot;) as pickle_model:</span>
<span class="sd">    model = pickle.load(pickle_model)</span>
<span class="sd">    </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">model_path = Path(</span><span class="se">\&quot;</span><span class="s2">/models/resources/viya/</span><span class="si">{</span><span class="n">model_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">)</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">with open(model_path / </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">rb</span><span class="se">\&quot;</span><span class="s2">) as pickle_model:</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}</span><span class="s2">model = </span><span class="si">{</span><span class="n">pickle_type</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;.load(pickle_model)&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_viya4_model_load</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pickle_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mojo_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">binary_h2o_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">tf_keras_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">tf_core_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the model load section of the score code assuming the model is being</span>
<span class="sd">        uploaded to SAS Viya 4.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_file_name : string</span>
<span class="sd">            Name of the model file that contains the model.</span>
<span class="sd">        pickle_type : string, optional</span>
<span class="sd">            Indicator for the package used to serialize the model file to be uploaded to</span>
<span class="sd">            SAS Model Manager. The default value is `pickle`.</span>
<span class="sd">        mojo_model : boolean, optional</span>
<span class="sd">            Flag to indicate that the model is a H2O.ai MOJO model. The default value is</span>
<span class="sd">            None.</span>
<span class="sd">        binary_h2o_model : boolean, optional</span>
<span class="sd">            Flag to indicate that the model is a H2O.ai binary model. The default value</span>
<span class="sd">            is None.</span>
<span class="sd">        tf_keras_model : boolean, optional</span>
<span class="sd">            Flag to indicate that the model is a tensorflow keras model. The default</span>
<span class="sd">            value is False.</span>
<span class="sd">        tf_core_model : boolean, optional</span>
<span class="sd">            Flag to indicate that the model is a tensorflow core model. The default</span>
<span class="sd">            value is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pickle_type</span> <span class="o">=</span> <span class="n">pickle_type</span> <span class="k">if</span> <span class="n">pickle_type</span> <span class="k">else</span> <span class="s2">&quot;pickle&quot;</span>

        <span class="k">if</span> <span class="n">mojo_model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;model = h2o.import_mojo(str(Path(settings.pickle_path&quot;</span>
                <span class="sa">f</span><span class="s1">&#39;) / &quot;</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="s1">&quot;))</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">model = h2o.import_mojo(str(Path(settings.pickle_path) / &quot;model.mojo&quot;))</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">model = h2o.import_mojo(str(Path(settings.pickle_path) / &quot;</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="s1">&quot;))</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">binary_h2o_model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;model = h2o.load(str(Path(settings.pickle_path) / &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="s2">))</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">model = h2o.load(str(Path(settings.pickle_path) / &quot;model.h2o&quot;))</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">model = h2o.load(str(Path(settings.pickle_path) / &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="s2">))</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">tf_keras_model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;model = tf.keras.models.load_model(Path(settings.pickle_path) / &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">model_file_name</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.h5&#39;</span><span class="p">))</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;safe_mode=True)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">model = tf.keras.models.load_model(Path(settings.pickle_path) / &quot;model.h5&quot;, safe_mode=True)</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">model = tf.keras.models.load_model(Path(settings.pickle_path) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;/ </span><span class="se">\&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">model_file_name</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.h5&#39;</span><span class="p">))</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;safe_mode=True)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;with open(Path(settings.pickle_path) / &quot;</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="s1">&quot;, &quot;rb&quot;) as pickle_model:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">model = </span><span class="si">{</span><span class="n">pickle_type</span><span class="si">}</span><span class="s2">.load(pickle_model)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">with open(Path(settings.pickle_path) / &quot;model.pickle&quot;, &quot;rb&quot;) as pickle_model:</span>
<span class="sd">    model = pickleload(pickle_model)</span>
<span class="sd">    </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">with open(Path(settings.pickle_path) / &quot;</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">model_file_name</span><span class="si">}</span><span class="s1">&quot;, &quot;rb&quot;) as pickle_model:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}</span><span class="s2">model = </span><span class="si">{</span><span class="n">pickle_type</span><span class="si">}</span><span class="s2">.load(pickle_model)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_impute_missing_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">missing_values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the missing value imputation function of the score code. This section of</span>
<span class="sd">        the score code is optional and is in a separate function at the bottom of the</span>
<span class="sd">        generated score code.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pandas.DataFrame</span>
<span class="sd">            Input dataset for model training or predictions.</span>
<span class="sd">        missing_values : bool, list, or dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">def impute_missing_values(data):</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">def impute_missing_values(data):</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">missing_values</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">numeric_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            <span class="p">]</span>
            <span class="n">character_columns</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">binary_columns</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">unique_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">unique_values</span>
                <span class="p">):</span>
                    <span class="n">binary_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">numeric_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">binary_columns</span><span class="p">))</span>
            <span class="n">character_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">character_columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">binary_columns</span><span class="p">))</span>
            <span class="n">impute_values</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]:</span>
                <span class="n">impute_values</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">character_columns</span><span class="p">]:</span>
                <span class="n">impute_values</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">binary_columns</span><span class="p">]:</span>
                <span class="n">impute_values</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">missing_values</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">impute_values</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">imp_val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">missing_values</span><span class="p">):</span>
                <span class="n">impute_values</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">imp_val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">impute_values</span> <span class="o">=</span> <span class="n">missing_values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">impute_values = </span><span class="se">\\\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_indent_string</span><span class="p">(</span>
            <span class="n">impute_values</span><span class="p">,</span> <span class="mi">8</span>
        <span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    impute_values = \\\n + {&quot;var1&quot;: 0, &quot;var2&quot;: &quot;&quot;, &quot;var3&quot;: 125.3}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">return data.replace(&#39;           .&#39;, np.nan).fillna(impute_values).apply(pd.to_numeric, errors=&#39;ignore&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">    return data.replace(&#39;           .&#39;, np.nan).fillna(impute_values).apply(pd.to_numeric, errors=&#39;ignore&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="c1"># TODO: Needs unit test</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_wrap_indent_string</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the textwrap package to wrap and indent strings longer than 88 characters in</span>
<span class="sd">        width. The indent value is subtracted from 88 to determine the correct length.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text : any value accepted by builtins.str()</span>
<span class="sd">            String text to be wrapped and indented.</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            Indent length for the wrapped text. Default value is 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Wrapped and indented string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wrapped_lines</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">88</span> <span class="o">-</span> <span class="n">indent</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indent</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:{</span><span class="n">indent</span><span class="si">}}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">wrapped_lines</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">wrapped_lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_predict_method</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">List</span><span class="p">],</span>
        <span class="n">var_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">dtype_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">missing_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">statsmodels_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">tf_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the model prediction section of the score code.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : function -&gt; list</span>
<span class="sd">            The Python function used for model predictions.</span>
<span class="sd">        var_list : list of str</span>
<span class="sd">            List of variable names.</span>
<span class="sd">        dtype_list : list of str, optional</span>
<span class="sd">            List of variable data types. The default value is None.</span>
<span class="sd">        missing_values : any, optional</span>
<span class="sd">            Flag for indicating if missing values should be imputed. The default value</span>
<span class="sd">            is None.</span>
<span class="sd">        statsmodels_model : bool, optional</span>
<span class="sd">            Flag to indicate that the model is a statsmodels model. The default value is</span>
<span class="sd">            False.</span>
<span class="sd">        tf_model : bool, optional</span>
<span class="sd">            Flag to indicate that the model is a tensorflow model. The default value is</span>
<span class="sd">            False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">index=None</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if not isinstance(</span><span class="si">{</span><span class="n">var_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, pd.Series):</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">index=[0]</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">index=None</span>
<span class="sd">if not isinstance(var1, pd.Series):</span>
<span class="sd">    index=[0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># H2O models</span>
        <span class="k">if</span> <span class="n">dtype_list</span><span class="p">:</span>
            <span class="n">column_types</span> <span class="o">=</span> <span class="s2">&quot;{&quot;</span>
            <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">var_list</span><span class="p">,</span> <span class="n">dtype_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">dtype</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">]):</span>
                    <span class="n">col_type</span> <span class="o">=</span> <span class="s2">&quot;numeric&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">col_type</span> <span class="o">=</span> <span class="s2">&quot;string&quot;</span>
                <span class="n">column_types</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&quot;: &quot;</span><span class="si">{</span><span class="n">col_type</span><span class="si">}</span><span class="s1">&quot;, &#39;</span>
            <span class="n">column_types</span> <span class="o">=</span> <span class="n">column_types</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
            <span class="n">column_types</span> <span class="o">+=</span> <span class="s2">&quot;}&quot;</span>
            <span class="n">input_dict</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">var_list</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">input_array = pd.DataFrame(</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">input_frame</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">{{</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span><span class="si">}</span><span class="se">}}</span><span class="s1">, index=index&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_indent_string</span><span class="p">(</span><span class="n">input_frame</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">missing_values</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">input_array = impute_missing_values(input_array)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">column_types = </span><span class="si">{</span><span class="n">column_types</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">h2o_array = h2o.H2OFrame(input_array, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;column_types=column_types)</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">prediction = &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;model.</span><span class="si">{</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(h2o_array)</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">prediction&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; = h2o.as_list(prediction, use_pandas=prediction.shape[0]&gt;1)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    input_array = pd.DataFrame(</span>
<span class="sd">        {&quot;var1&quot;: var1, &quot;var2&quot;: var2, &quot;var3&quot;: var3}</span>
<span class="sd">    )</span>
<span class="sd">    input_array = impute_missing_values(input_array)</span>
<span class="sd">    column_types = {&quot;var1&quot;: &quot;string&quot;, &quot;var2&quot;: &quot;numeric&quot;, &quot;var3&quot;: &quot;numeric&quot;}</span>
<span class="sd">    h2o_array = h2o.H2OFrame(input_array, column_types=column_types)</span>
<span class="sd">    prediction = model.predict(h2o_array)</span>
<span class="sd">    prediction = h2o.as_list(prediction, use_pandas=False)</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="c1"># Statsmodels models</span>
        <span class="k">elif</span> <span class="n">statsmodels_model</span><span class="p">:</span>
            <span class="n">var_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;const&quot;</span><span class="p">)</span>
            <span class="n">input_dict</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">var_list</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if not isinstance(</span><span class="se">\&quot;</span><span class="si">{</span><span class="n">var_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">, pd.Series):</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">const = 1</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">const = pd.Series([1 for x in len(</span><span class="si">{</span><span class="n">var_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">)])&quot;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if not isinstance(&quot;var1&quot;, pd.Series):</span>
<span class="sd">        const = 1</span>
<span class="sd">    else:</span>
<span class="sd">        const = pd.Series([1 for x in len(var1)])</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">input_array = pd.DataFrame(</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">input_frame</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">{{</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span><span class="si">}</span><span class="se">}}</span><span class="s1">, index=index&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_indent_string</span><span class="p">(</span><span class="n">input_frame</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">missing_values</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">input_array = impute_missing_values(input_array)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">prediction = model.</span><span class="si">{</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(input_array)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    input_array = pd.DataFrame(</span>
<span class="sd">        {&quot;const&quot;: const, &quot;var1&quot;: var1, &quot;var2&quot;: var2, &quot;var3&quot;: var3}</span>
<span class="sd">    )</span>
<span class="sd">    input_array = impute_missing_values(input_array)</span>
<span class="sd">    prediction = model.predict(input_array)</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">elif</span> <span class="n">tf_model</span><span class="p">:</span>
            <span class="n">input_dict</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">var_list</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">input_array = pd.DataFrame(</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">input_frame</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">{{</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span><span class="si">}</span><span class="se">}}</span><span class="s1">, index=index&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_indent_string</span><span class="p">(</span><span class="n">input_frame</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">missing_values</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">input_array = impute_missing_values(input_array)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">prediction = model.</span><span class="si">{</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(input_array)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2"> # Check if model returns logits or probabilities</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if not math.isclose(sum(predictions[0]), 1, rel_tol=.01):</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">predictions = [tf.nn.softmax(p).numpy().tolist() for p in &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;predictions]</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">predictions = [p.tolist() for p in predictions]</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    input_array = pd.DataFrame(</span>
<span class="sd">        {&quot;var1&quot;: var1, &quot;var2&quot;: var2, &quot;var3&quot;: var3}</span>
<span class="sd">    )</span>
<span class="sd">    input_array = impute_missing_values(input_array)</span>
<span class="sd">    prediction = model.predict(input_array)</span>
<span class="sd">    </span>
<span class="sd">    # Check if model returns logits or probabilities</span>
<span class="sd">    if not math.isclose(sum(predictions[0]), 1, rel_tol=.01):</span>
<span class="sd">        predictions = [tf.nn.softmax(p).numpy().tolist() for p in predictions]</span>
<span class="sd">    else:</span>
<span class="sd">        predictions = [p.tolist() for p in predictions]    </span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">input_dict</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">var_list</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">input_array = pd.DataFrame(</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">input_frame</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">{{</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span><span class="si">}</span><span class="se">}}</span><span class="s1">, index=index&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_indent_string</span><span class="p">(</span><span class="n">input_frame</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">missing_values</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">input_array = impute_missing_values(input_array)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">prediction = model.</span><span class="si">{</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(input_array).tolist()</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    input_array = pd.DataFrame(</span>
<span class="sd">        {&quot;var1&quot;: var1, &quot;var2&quot;: var2, &quot;var3&quot;: var3}</span>
<span class="sd">    )</span>
<span class="sd">    input_array = impute_missing_values(input_array)</span>
<span class="sd">    prediction = model.predict(input_array)</span>
<span class="sd">            &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_determine_score_metrics</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">predict_returns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">target_variable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Using the types from the prediction method returns in `predict_method`, create</span>
<span class="sd">        output score metrics for the score code.</span>

<span class="sd">        If no target_variable is provided and classification outputs are expected, the</span>
<span class="sd">        function will produce a warning and use the generic &quot;I_Classification&quot; score</span>
<span class="sd">        metric.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        predict_returns : list</span>
<span class="sd">            A list of the return types of the prediction method. These can be direct</span>
<span class="sd">            types or example values.</span>
<span class="sd">        target_variable : str</span>
<span class="sd">            Target variable to be predicted by the model. The default value is None.</span>
<span class="sd">        target_values : list, optional</span>
<span class="sd">            A list of target values for the target variable. The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            A list containing string values for the model&#39;s score metrics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a list mapped to the prediction returns that signifies their type</span>
        <span class="n">predict_returns</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_determine_returns_type</span><span class="p">(</span><span class="n">predict_returns</span><span class="p">)</span>

        <span class="c1"># No target values signals that the model is a prediction (regression) model</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_values</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predict_returns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;When no target values are provided, a prediction model is assumed.&quot;</span>
                    <span class="s2">&quot; Currently, SAS Model Manager only supports prediction models with&quot;</span>
                    <span class="s2">&quot; singular outputs, therefore the score code cannot be written for &quot;</span>
                    <span class="s2">&quot;this model. To continue with generating the score code for this&quot;</span>
                    <span class="s2">&quot;model, please either provide the target values or define the score&quot;</span>
                    <span class="s2">&quot; metrics explicitly.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># Use generic prediction variable if none provided</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">target_variable</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;WARNING: No score metrics or target variables were provided for a &quot;</span>
                    <span class="s2">&quot;prediction model. Therefore the output score metric is defaulted &quot;</span>
                    <span class="s1">&#39;to &quot;I_Prediction&quot;&#39;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;I_Prediction&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">target_variable</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;I_</span><span class="si">{</span><span class="n">target_variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="c1"># A model with only one expected target value will always get the same answer</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_values</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Please provide all possible values for the target variable, including&quot;</span>
                <span class="s2">&quot; a no-event value.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Binary classification models</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">predict_returns</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">predict_returns</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Binary classification models should not return more than 1 &quot;</span>
                    <span class="s2">&quot;classification value or more than 2 probability values. For &quot;</span>
                    <span class="s2">&quot;example: [I_Class, P_1, P_0] has the maximum number of returns.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gen</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_yield_score_metrics</span><span class="p">(</span>
                    <span class="n">predict_returns</span><span class="p">,</span> <span class="n">target_values</span><span class="p">,</span> <span class="n">target_variable</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">metric</span> <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">]</span>
        <span class="c1"># Multiclass classification models</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">predict_returns</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;SAS Model Manager does not currently support models with more than&quot;</span>
                    <span class="s2">&quot; one target variable.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">predict_returns</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The number of target values provided does not match the number of&quot;</span>
                    <span class="s2">&quot; returns from the prediction method that are probabilities.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gen</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_yield_score_metrics</span><span class="p">(</span>
                    <span class="n">predict_returns</span><span class="p">,</span> <span class="n">target_values</span><span class="p">,</span> <span class="n">target_variable</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">metric</span> <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_yield_score_metrics</span><span class="p">(</span>
        <span class="n">returns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
        <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">variable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For classification models without provided metrics, yield score metrics as</span>
<span class="sd">        determined by the target values, target variable, and returns from the</span>
<span class="sd">        prediction method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        returns : list of bool</span>
<span class="sd">            A list of bools, such that `True` represents classification values and</span>
<span class="sd">            `False` represents probability or prediction values.</span>
<span class="sd">        variable : str</span>
<span class="sd">            Target variable to be predicted by the model.</span>
<span class="sd">        values : list</span>
<span class="sd">            A list of target values for the target variable.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        generator</span>
<span class="sd">            A generator containing metrics corresponding to the prediction returns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proba_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">returns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="c1"># If True, then classification score metric</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">variable</span><span class="p">:</span>
                    <span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;WARNING: No target variable was provided, therefore the &quot;</span>
                        <span class="s1">&#39;classification variable defaults to &quot;I_Classification&quot;.&#39;</span>
                    <span class="p">)</span>
                <span class="k">yield</span> <span class="s2">&quot;I_&quot;</span> <span class="o">+</span> <span class="n">variable</span> <span class="k">if</span> <span class="n">variable</span> <span class="k">else</span> <span class="s2">&quot;I_Classification&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If False, then prediction or probability score metric</span>
                <span class="k">yield</span> <span class="s2">&quot;P_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">proba_count</span><span class="p">])</span>
                <span class="n">proba_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_determine_returns_type</span><span class="p">(</span><span class="n">outputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the return type of the prediction method.</span>

<span class="sd">        Returns a list of equal size to input argument, which contains `True` for</span>
<span class="sd">        classification values and `False` for probability or prediction values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        outputs : list</span>
<span class="sd">            The list of expected outputs from the prediction method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        returns : List of bool</span>
<span class="sd">            A list mapped to the input argument, such that `True` represents</span>
<span class="sd">            classification values and `False` represents probability or prediction</span>
<span class="sd">            values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">is_str</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">or</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">is_str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_predictions_to_metrics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">predict_returns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">target_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">predict_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">h2o_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">target_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Using the provided arguments, write in to the score code the method for handling</span>
<span class="sd">        the generated predictions.</span>

<span class="sd">        Errors are raised for improper combinations of metrics, target values, and</span>
<span class="sd">        predict method returns.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        metrics : list of str</span>
<span class="sd">            A list of strings corresponding to the outputs of the model to SAS Model</span>
<span class="sd">            Manager.</span>
<span class="sd">        predict_returns : list</span>
<span class="sd">            A list of the return types of the prediction method. These can be direct</span>
<span class="sd">            types or example values.</span>
<span class="sd">        target_values : list of str, optional</span>
<span class="sd">            A list of target values for the target variable. The default value is None.</span>
<span class="sd">        predict_threshold : float, optional</span>
<span class="sd">            The prediction threshold for normalized probability score_metrics. Values</span>
<span class="sd">             are expected to be between 0 and 1. The default value is None.</span>
<span class="sd">        h2o_model : bool, optional</span>
<span class="sd">            Flag to indicate that the model is an H2O.ai model. The default value is</span>
<span class="sd">            False.</span>
<span class="sd">        target_index : int, optional</span>
<span class="sd">            Sets the index of success for a binary model. If target_values are given, this</span>
<span class="sd">            index should match the index of the target outcome in target_values. If target_values</span>
<span class="sd">            are not given, this index should indicate whether the the target probability variable</span>
<span class="sd">            is the first or second variable returned by the model. The default value is 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_index</span><span class="p">:</span>
            <span class="n">target_index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># Flatten single valued list</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Prediction model or no-calculation classification model</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">target_values</span> <span class="ow">or</span> <span class="n">predict_threshold</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_no_targets_no_thresholds</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">predict_returns</span><span class="p">,</span> <span class="n">h2o_model</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">target_values</span> <span class="ow">and</span> <span class="n">predict_threshold</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;A threshold was provided to interpret the prediction results, however &quot;</span>
                <span class="s2">&quot;a target value was not, therefore, a valid output cannot be generated.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Binary classification model</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_binary_target</span><span class="p">(</span>
                <span class="n">metrics</span><span class="p">,</span>
                <span class="n">target_values</span><span class="p">,</span>
                <span class="n">predict_returns</span><span class="p">,</span>
                <span class="n">predict_threshold</span><span class="p">,</span>
                <span class="n">target_index</span><span class="p">,</span>
                <span class="n">h2o_model</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># Multiclass classification model</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nonbinary_targets</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">target_values</span><span class="p">,</span> <span class="n">predict_returns</span><span class="p">,</span> <span class="n">h2o_model</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_no_targets_no_thresholds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">metrics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">returns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">h2o_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle prediction outputs where the prediction does not expect handling by the</span>
<span class="sd">        score code.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        metrics : list of str or str</span>
<span class="sd">            A list of strings corresponding to the outputs of the model to SAS Model</span>
<span class="sd">            Manager.</span>
<span class="sd">        returns : list</span>
<span class="sd">            The list of expected outputs from the prediction method.</span>
<span class="sd">        h2o_model : bool, optional</span>
<span class="sd">            Flag to indicate that the model is an H2O.ai model. The default value is</span>
<span class="sd">            False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
            <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">h2o_model</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The number of returns from the predict function does not match the &quot;</span>
                <span class="s2">&quot;number of score metrics provided. Either provide target values for the&quot;</span>
                <span class="s2">&quot; score code to use in calculating the classification value or update &quot;</span>
                <span class="s2">&quot;the provided score metrics and prediction returns.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Classification (with only classification output) or prediction model</span>
            <span class="k">if</span> <span class="n">h2o_model</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}{</span><span class="n">metrics</span><span class="si">}</span><span class="s2"> = prediction[1][0]</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = prediction.drop(prediction.columns[1:], axis=1)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table.columns = [&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&#39;]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        Classification = prediction[1][0]</span>
<span class="sd">        return Classification</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = prediction.drop(prediction.columns[1:], axis=1)</span>
<span class="sd">        output_table.columns = [&#39;Classification&#39;]</span>
<span class="sd">        return output_table</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}{</span><span class="n">metrics</span><span class="si">}</span><span class="s2"> = prediction[0][0]</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&#39;: prediction</span><span class="se">}}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        Classification = prediction[0][0]</span>
<span class="sd">        return Classification</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = pd.DataFrame({&#39;Classification&#39;: prediction})</span>
<span class="sd">        return output_table</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Classification model including predictions and classification</span>
            <span class="k">if</span> <span class="n">h2o_model</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = prediction[1][0]</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> = float(prediction[1][</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">])</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">prediction.columns = </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        Classification = prediction[1][0]</span>
<span class="sd">        Proba_A = float(prediction[1][1])</span>
<span class="sd">        Proba_B = float(prediction[1][2])</span>
<span class="sd">        Proba_C = float(prediction[1][3])</span>
<span class="sd">        return Classification, Proba_A, Proba_B, Proba_C</span>
<span class="sd">    else:</span>
<span class="sd">        prediction.columns = [&#39;Classification&#39;, &#39;Proba_A&#39;, &#39;Proba_B&#39;, &#39;Proba_C&#39;]</span>
<span class="sd">        return prediction</span>

<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> = prediction[0][</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(prediction, columns=</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        Classification = prediction[0][0]</span>
<span class="sd">        Proba_A = prediction[0][1]</span>
<span class="sd">        Proba_B = prediction[0][2]</span>
<span class="sd">        Proba_C = prediction[0][3]</span>

<span class="sd">        return Classification, Proba_A, Proba_B, Proba_C</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = pd.DataFrame(prediction, columns=[&#39;Classification&#39;, &#39;Proba_A&#39;, &#39;Proba_B&#39;, &#39;Proba_C&#39;])</span>
<span class="sd">        return output_table</span>

<span class="sd">            &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_binary_target</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">metrics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">target_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">returns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">h2o_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle binary model prediction outputs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        metrics : list of str or str</span>
<span class="sd">            A list of strings corresponding to the outputs of the model to SAS Model</span>
<span class="sd">            Manager.</span>
<span class="sd">        target_values : list of str</span>
<span class="sd">            A list of target values for the target variable.</span>
<span class="sd">        returns : list</span>
<span class="sd">            The list of expected outputs from the prediction method.</span>
<span class="sd">        threshold : float, optional</span>
<span class="sd">            The prediction threshold for normalized probability score_metrics. Values</span>
<span class="sd">             are expected to be between 0 and 1. The default value is None.</span>
<span class="sd">        h2o_model : bool, optional</span>
<span class="sd">            Flag to indicate that the model is an H2O.ai model. The default value is</span>
<span class="sd">            False.</span>
<span class="sd">        target_index : int, optional</span>
<span class="sd">            Sets the index of the probability value to be returned from a binary model. The</span>
<span class="sd">            default value is two for h2o models, and one otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="c1"># Set default threshold</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="n">returns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_returns_type</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The prediction method has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span><span class="si">}</span><span class="s2"> returns. The score code &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;generation cannot parse that many return values for a binary &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;classification model.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Based on the return types provided, the prediction method returns &quot;</span>
                <span class="s2">&quot;multiple classification values. Multilabel models are not supported.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># For h2o models with only one metric provided, return the classification</span>
            <span class="k">if</span> <span class="n">h2o_model</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">if prediction[1][</span><span class="si">{</span><span class="n">target_index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&#39;: np.where(prediction[prediction.columns[</span><span class="si">{</span><span class="n">target_index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">]] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">, &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="s2">&#39;)</span><span class="se">}}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        if prediction[1][2] &gt; 0.5:</span>
<span class="sd">            Classification = &quot;A&quot;</span>
<span class="sd">        else:</span>
<span class="sd">            Classification = &quot;B&quot;</span>
<span class="sd">        return Classification</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = pd.DataFrame({&#39;Classification&#39;: np.where(prediction[prediction.columns[2]] &gt; .5, &#39;B&#39;, &#39;A&#39;)})</span>
<span class="sd">        return output_table</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="c1"># One return that is the classification</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">returns</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction[0]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&#39;: prediction</span><span class="se">}}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[0]</span>
<span class="sd">    else:</span>
<span class="sd">        return pd.DataFrame({&#39;Classification&#39;: prediction})</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="c1"># One return that is a probability</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">returns</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">if prediction[0] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&#39;: [&#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; if p &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2"> else &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="s2">&#39; for p in prediction]</span><span class="se">}}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        if prediction[0] &gt; 0.5:</span>
<span class="sd">            Classification = &quot;A&quot;</span>
<span class="sd">        else:</span>
<span class="sd">            Classification = &quot;B&quot;</span>
<span class="sd">        return Classification</span>
<span class="sd">    else:</span>
<span class="sd">        return pd.DataFrame({&#39;Classification&#39;: [&#39;B&#39; if p &gt; 0.5 else &#39;A&#39; for p in prediction]})</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="c1"># Two returns from the prediction method</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Only probabilities returned; return classification for larger value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">if prediction[0][</span><span class="si">{</span><span class="n">target_index</span><span class="si">}</span><span class="s2">] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="se">\&quot;\n\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">target_values = </span><span class="si">{</span><span class="n">target_values</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">prediction = pd.DataFrame(prediction)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&#39;: np.where(prediction[prediction.columns[</span><span class="si">{</span><span class="n">target_index</span><span class="si">}</span><span class="s2">]] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">, &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="s2">&#39;)</span><span class="se">}}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        if prediction[0][0] &gt; .5:</span>
<span class="sd">            Classification = &quot;B&quot;</span>
<span class="sd">        else:</span>
<span class="sd">            Classification = &quot;A&quot;</span>

<span class="sd">        return Classification</span>
<span class="sd">    else:</span>
<span class="sd">        target_values = [&#39;A&#39;, &#39;B&#39;]</span>
<span class="sd">        output_table = pd.DataFrame({&#39;Classification&#39; : np.array(target_values)[np.argmax(prediction, axis=1)]})</span>
<span class="sd">        return output_table</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="c1"># Classification and probability returned; return classification value</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># TODO: Either figure out how to handle threshold or add warning</span>
                <span class="c1"># Determine which return is the classification value</span>
                <span class="n">class_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}{</span><span class="n">metrics</span><span class="si">}</span><span class="s2"> = prediction[0][</span><span class="si">{</span><span class="n">class_index</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&#39;: [p[</span><span class="si">{</span><span class="n">class_index</span><span class="si">}</span><span class="s2">] for p in prediction]</span><span class="se">}}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        Classification = prediction[0][1]</span>
<span class="sd">        return Classification</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = pd.DataFrame({&#39;Classification&#39;: [p[1] for p in prediction]})</span>
<span class="sd">        return output_table</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_invalid_predict_config</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># H2O models with two metrics are assumed to be classification + probability</span>
            <span class="k">if</span> <span class="n">h2o_model</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;For H2O models, it is assumed if two metrics are provided, the &quot;</span>
                    <span class="s2">&quot;score code should output the classification and probability for &quot;</span>
                    <span class="s2">&quot;the target event to occur.&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">if prediction[1][</span><span class="si">{</span><span class="n">target_index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, float(prediction[1][</span><span class="si">{</span><span class="n">target_index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">])</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = prediction.drop(prediction.columns[</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">], axis=1)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">classifications = np.where(prediction[prediction.columns[</span><span class="si">{</span><span class="n">target_index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">]] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">, &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="s2">&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table.columns = </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table[&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;] = classifications</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        if prediction[1][1] &gt; 0.5:</span>
<span class="sd">            Classification = &#39;1&#39;</span>
<span class="sd">        else:</span>
<span class="sd">            Classification = &#39;0&#39;</span>
<span class="sd">        return EM_CLASSIFICATION, float(prediction[1][1])</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = prediction.drop(prediction.columns[2], axis=1)</span>
<span class="sd">        classifications = np.where(prediction[prediction.columns[1]] &gt; 0.5, &#39;0&#39;, &#39;1&#39;)</span>
<span class="sd">        output_table.columns = [&#39;EM_CLASSIFICATION&#39;, &#39;EM_EVENTPROBABILITY&#39;]</span>
<span class="sd">        output_table[&#39;EM_CLASSIFICATION&#39;] = classifications</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="c1"># Calculate the classification; return the classification and probability</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Due to the ambiguity of differentiating the classification and &quot;</span>
                    <span class="s2">&quot;probability output metrics, it is assumed that the classification &quot;</span>
                    <span class="s2">&quot;metric is returned first.&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">if prediction[0] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="se">\&quot;\n\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, prediction[0]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">classifications = [&#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; if p &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2"> else &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="s2">&#39; for p in prediction]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: classifications, &#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: prediction</span><span class="se">}}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        if prediction[0] &gt; 0.5:</span>
<span class="sd">            Classification = &quot;B&quot;</span>
<span class="sd">        else:</span>
<span class="sd">            Classification = &quot;A&quot;</span>

<span class="sd">        return Classification, prediction[0]</span>
<span class="sd">    else:</span>
<span class="sd">        classifications = [&#39;B&#39; if p &gt; 0.5 else &#39;A&#39; for p in prediction]</span>
<span class="sd">        return pd.DataFrame({&#39;Classification&#39;: classifications, &#39;Probability&#39;: prediction})</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="c1"># Calculate the classification; return the classification and probability</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Due to the ambiguity of the provided metrics and prediction return&quot;</span>
                    <span class="s2">&quot; types, the score code assumes that a classification and the &quot;</span>
                    <span class="s2">&quot;target event probability should be returned.&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">if prediction[0][</span><span class="si">{</span><span class="n">target_index</span><span class="si">}</span><span class="s2">] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, prediction[0][</span><span class="si">{</span><span class="n">target_index</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">df = pd.DataFrame(prediction)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">proba = df[</span><span class="si">{</span><span class="n">target_index</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">classifications = np.where(df[</span><span class="si">{</span><span class="n">target_index</span><span class="si">}</span><span class="s2">] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">, &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="s2">&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: classifications, &#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: proba</span><span class="se">}}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        if prediction[0][1] &gt; .5:</span>
<span class="sd">            Classification = &quot;B&quot;</span>
<span class="sd">        else:</span>
<span class="sd">            Classification = &quot;A&quot;</span>
<span class="sd">        return Classification, prediction[0][1]</span>
<span class="sd">    else:</span>
<span class="sd">        df = pd.DataFrame(prediction)</span>
<span class="sd">        proba = df[0]</span>
<span class="sd">        classifications = np.where(df[1] &gt; .5, &#39;B&#39;, &#39;A&#39;)</span>
<span class="sd">        return pd.DataFrame({&#39;Classification&#39;: classifications, &#39;Probability&#39;: proba})</span>
<span class="sd">                                &quot;&quot;&quot;</span>
            <span class="c1"># TODO: Potentially add threshold</span>
            <span class="c1"># Return classification and probability value</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction[0][0], prediction[0][1]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return pd.DataFrame(prediction, columns=</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[0][0], prediction[0][1]</span>
<span class="sd">    else:</span>
<span class="sd">        return pd.DataFrame(prediction, columns=[&#39;Classification&#39;, &#39;Probability&#39;])</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Due to the ambiguity of the provided metrics and prediction return&quot;</span>
                    <span class="s2">&quot; types, the score code assumes that a classification and the &quot;</span>
                    <span class="s2">&quot;target event probability should be returned.&quot;</span>
                <span class="p">)</span>
                <span class="c1"># Determine which return is the classification value</span>
                <span class="n">class_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">class_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction[0][0], prediction[0][</span><span class="si">{</span><span class="n">target_index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">prediction = pd.DataFrame(prediction)</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = prediction.drop(prediction.columns[</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">], axis=1)</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table.columns = </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                    <span class="p">)</span>

<span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[0][0], prediction[0][2]</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = prediction.drop(prediction.columns[1], axis=1)</span>
<span class="sd">        output_table.columns = [&quot;Classification&quot;, &quot;Probability&quot;]</span>
<span class="sd">        return output_table</span>
<span class="sd">                    &quot;&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction[0][</span><span class="si">{</span><span class="n">class_index</span><span class="si">}</span><span class="s2">], prediction[0][</span><span class="si">{</span><span class="n">target_index</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">prediction = pd.DataFrame(prediction)</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = prediction.drop(prediction.columns[</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">], axis=1)</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = output_table[output_table.columns[::-1]]</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table.columns = </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                    <span class="p">)</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[0][2], prediction[0][0]</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = prediction.drop(prediction.columns[0], axis=1)</span>
<span class="sd">        output_table = output_table[output_table.columns[::-1]]</span>
<span class="sd">        output_table.columns = [&quot;Classification&quot;, &quot;Probability&quot;]</span>
<span class="sd">        return output_table.drop(&#39;drop&#39;, axis=1)</span>
<span class="sd">                    &quot;&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_invalid_predict_config</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h2o_model</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction[1][0], float(prediction[1][1]), &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;float(prediction[1][2])</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">prediction.columns = </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[1][0], float(prediction[1][1]), float(prediction[1][2])</span>
<span class="sd">    else:</span>
<span class="sd">        prediction.columns = [&#39;Classification&#39;, &#39;Proba_0&#39;, &#39;Proba_1&#39;]</span>
<span class="sd">        return prediction</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Due to the ambiguity of the provided metrics and prediction return&quot;</span>
                    <span class="s2">&quot; types, the score code assumes the return order to be: &quot;</span>
                    <span class="s2">&quot;[classification, probability of event, probability of no event].&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">if prediction[0] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, prediction[0], 1 - prediction[0]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">classifications = [&#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; if p &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2"> else &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="s2">&#39; for p in prediction]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: classifications, &#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: prediction</span><span class="se">}}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table[&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;] = 1 - output_table[&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        if prediction[0] &gt; 0.5:</span>
<span class="sd">            Classification = &quot;B&quot;</span>
<span class="sd">        else:</span>
<span class="sd">            Classification = &quot;A&quot;</span>
<span class="sd">        return Classification, prediction[0], 1 - prediction[0]</span>
<span class="sd">    else:</span>
<span class="sd">        classifications = [&#39;B&#39; if p &gt; 0.5 else &#39;A&#39; for p in prediction]</span>
<span class="sd">        output_table = pd.DataFrame({&#39;Classification&#39;: classifications, &#39;Proba_0&#39;: prediction})</span>
<span class="sd">        output_table[&#39;Proba_1&#39;] = 1 - output_table[&#39;Proba_0&#39;]</span>
<span class="sd">        return output_table</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># TODO: Make decision on whether ordering should follow given pattern or reflect input ordering</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Due to the ambiguity of the provided metrics and prediction return&quot;</span>
                    <span class="s2">&quot; types, the score code assumes the return order to be: &quot;</span>
                    <span class="s2">&quot;[classification, probability of event, probability of no event] &quot;</span>
                    <span class="s2">&quot;for a single return. For batch scoring, the return order of the &quot;</span>
                    <span class="s2">&quot;probabilities will mirror their return order in the model.&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">if prediction[0][</span><span class="si">{</span><span class="n">target_index</span><span class="si">}</span><span class="s2">] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">12</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, prediction[0][</span><span class="si">{</span><span class="n">target_index</span><span class="si">}</span><span class="s2">], prediction[0][</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(prediction, columns=</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">classifications = np.where(output_table[output_table.columns[</span><span class="si">{</span><span class="n">target_index</span><span class="si">}</span><span class="s2">]] &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">, &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, &#39;</span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="s2">&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table.insert(loc=0, column=&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, value=classifications)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        if prediction[0][0] &gt; prediction[0][1]:</span>
<span class="sd">            Classification = &quot;A&quot;</span>
<span class="sd">        else:</span>
<span class="sd">            Classification = &quot;B&quot;</span>
<span class="sd">        return Classification, prediction[0][0], prediction[0][1]</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = pd.DataFrame(prediction, columns=[&quot;Proba_0&quot;,&quot;Proba_1&quot;])</span>
<span class="sd">        classifications = np.where(prediction[prediction.columns[2]] &gt; .5, &#39;B&#39;, &#39;A&#39;)</span>
<span class="sd">        output_table.insert(loc=0, column=&#39;Classification&#39;, value=classifications)</span>
<span class="sd">        return output_table</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="c1"># Find which return is the classification, then return probabilities</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Determine which return is the classification value</span>
                <span class="n">class_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">class_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction[0][0], prediction[0][1], 1 - prediction[0][1]</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(prediction, columns=</span><span class="si">{</span><span class="n">metrics</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table[&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;] = 1 - output_table[&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;]</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                    <span class="p">)</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[0][0], prediction[0][1], 1 - prediction[0][1]</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = pd.DataFrame(prediction, columns=[&quot;Classification&quot;,&quot;Proba_0&quot;])</span>
<span class="sd">        output_table[&#39;Proba_1&#39;] = 1 - output_table[&#39;Proba_0&#39;]</span>
<span class="sd">        return output_table</span>
<span class="sd">                    &quot;&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction[0][1], prediction[0][0], 1 - prediction[0][0]</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(prediction, columns=</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = output_table[output_table.columns[::-1]]</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table[&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;] = 1 - output_table[&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;]</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                    <span class="p">)</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[0][1], prediction[0][0], 1 - prediction[0][0]</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = pd.DataFrame(prediction, columns=[&quot;Proba_0&quot;,&quot;Classification&quot;])</span>
<span class="sd">        output_table = output_table[output_table.columns[::-1]]</span>
<span class="sd">        output_table[&#39;Proba_1&#39;] = 1 - output_table[&#39;Proba_0&#39;]</span>
<span class="sd">        return output_table</span>
<span class="sd">                    &quot;&quot;&quot;</span>
            <span class="c1"># Return all values from prediction method</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction[0][0], prediction[0][1], prediction[0][2]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return pd.DataFrame(prediction, columns=</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[0][0], prediction[0][1], prediction[0][2]</span>
<span class="sd">    else:</span>
<span class="sd">        return pd.DataFrame(prediction, columns=[&#39;Classification&#39;, &#39;Proba_0&#39;, &#39;Proba_1&#39;])</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_invalid_predict_config</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Too many score metrics were provided for a binary model.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_nonbinary_targets</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">metrics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">target_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">returns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">h2o_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle multiclass model prediction outputs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        metrics : list of str or str</span>
<span class="sd">            A list of strings corresponding to the outputs of the model to SAS Model</span>
<span class="sd">            Manager.</span>
<span class="sd">        target_values : list of str, optional</span>
<span class="sd">            A list of target values for the target variable.</span>
<span class="sd">        returns : list</span>
<span class="sd">            The list of expected outputs from the prediction method.</span>
<span class="sd">        h2o_model : bool, optional</span>
<span class="sd">            Flag to indicate that the model is an H2O.ai model. The default value is</span>
<span class="sd">            False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">returns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_returns_type</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Based on the return types provided, the prediction method returns &quot;</span>
                <span class="s2">&quot;multiple classification values. Multilabel models are not supported.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Find the target value with the highest probability</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># For h2o models with only one metric provided, return the classification</span>
            <span class="k">if</span> <span class="n">h2o_model</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">target_values = </span><span class="si">{</span><span class="n">target_values</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}{</span><span class="n">metrics</span><span class="si">}</span><span class="s2"> = target_values[prediction[1][1:].&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;index(max(prediction[1][1:]))]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&#39;: np.array(target_values)[np.argmax(prediction.iloc[:, 1:].values, axis=1)]</span><span class="se">}}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    target_values = [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        Classification = target_values[prediction[1][1:].index(max(prediction[1][1:]))]</span>
<span class="sd">        return Classification</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = pd.DataFrame({&#39;Classification&#39;: np.array(target_values)[np.argmax(prediction.iloc[:, 1:].values, axis=1)]})</span>
<span class="sd">        return output_table</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="c1"># One return that is the classification</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction[0][0]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&#39;: prediction</span><span class="se">}}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[0]</span>
<span class="sd">    else:</span>
<span class="sd">        return pd.DataFrame({&#39;Classification&#39;: prediction})</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">target_values = </span><span class="si">{</span><span class="n">target_values</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return target_values[prediction[0].index(max(prediction[0]))]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&#39; : np.array(</span><span class="si">{</span><span class="n">target_values</span><span class="si">}</span><span class="s2">)[np.argmax(prediction, axis=1)]</span><span class="se">}}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        target_values = [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]</span>
<span class="sd">        return target_values[prediction[0].index(max(prediction[0]))]</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = pd.DataFrame({&#39;Classification&#39; : np.array([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;])[np.argmax(prediction, axis=1)]})</span>
<span class="sd">        return output_table</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Determine which return is the classification value</span>
                <span class="n">class_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction[0][</span><span class="si">{</span><span class="n">class_index</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&#39;: [p[</span><span class="si">{</span><span class="n">class_index</span><span class="si">}</span><span class="s2">] for p in prediction]</span><span class="se">}}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[0][0]</span>
<span class="sd">    else:</span>
<span class="sd">        return pd.DataFrame({&#39;Classification&#39;: [p[0] for p in prediction]})</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_invalid_predict_config</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h2o_model</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">target_values = </span><span class="si">{</span><span class="n">target_values</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = target_values[prediction[1][1:].&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;index(max(prediction[1][1:]))]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, max(prediction[1][1:])</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">index = np.argmax(prediction.iloc[0:, 1:].values, axis=1)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: np.array(target_values)[index], &#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: np.max(prediction.iloc[0:, 1:], axis=1)</span><span class="se">}}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    target_values = [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        Classification = target_values[prediction[1][1:].index(max(prediction[1][1:]))]</span>
<span class="sd">        return Classification, max(prediction[1][1:])</span>
<span class="sd">    else:</span>
<span class="sd">        index = np.argmax(prediction.iloc[0:, 1:].values, axis=1)</span>
<span class="sd">        return pd.DataFrame({&#39;Classification&#39;: np.array(target_values)[index], &#39;Probability&#39;: np.max(prediction.iloc[0:, 1:], axis=1)})</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">target_values = </span><span class="si">{</span><span class="n">target_values</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return target_values[prediction[0].index(max(prediction[0]))], &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;max(prediction[0])</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">df = pd.DataFrame(prediction)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">index = np.argmax(df.values, axis=1)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">classifications = np.array(target_values)[index]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">max_proba = np.max(df.values, axis=1)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: classifications, &#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: max_proba</span><span class="se">}}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    target_values = [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return target_values[prediction[0].index(max(prediction[0]))], max(prediction[0])</span>
<span class="sd">    else:</span>
<span class="sd">        df = pd.DataFrame(prediction)</span>
<span class="sd">        index = np.argmax(df.values, axis=1)</span>
<span class="sd">        classifications = np.array(target_values)[index]</span>
<span class="sd">        max_proba = np.max(df.values, axis=1)</span>
<span class="sd">        return pd.DataFrame({&#39;Classification&#39;: classifications, &#39;Probability&#39;: max_proba})</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Determine which return is the classification value</span>
                <span class="n">class_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction[0][</span><span class="si">{</span><span class="n">class_index</span><span class="si">}</span><span class="s2">], &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;max(prediction[0][:</span><span class="si">{</span><span class="n">class_index</span><span class="si">}</span><span class="s2">] + prediction[0][</span><span class="si">{</span><span class="n">class_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">:])</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">df = pd.DataFrame(prediction)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">probas = df.drop(</span><span class="si">{</span><span class="n">class_index</span><span class="si">}</span><span class="s2">, axis=1)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">max_proba = np.max(probas.values, axis=1)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return pd.DataFrame(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: df[</span><span class="si">{</span><span class="n">class_index</span><span class="si">}</span><span class="s2">], &#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: max_proba</span><span class="se">}}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[0][0], max(prediction[0][:0] + prediction[0][1:])</span>
<span class="sd">    else:</span>
<span class="sd">        df = pd.DataFrame(prediction)</span>
<span class="sd">        probas = df.drop(0, axis=1)</span>
<span class="sd">        max_proba = np.max(probas.values, axis=1)</span>
<span class="sd">        return pd.DataFrame({&#39;Classification&#39;: df[0], &#39;Probability&#39;: max_proba})</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_invalid_predict_config</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h2o_model</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">):</span>
                    <span class="n">h2o_returns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;prediction[1][</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">))]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">h2o_returns</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = prediction.drop(prediction.columns[0], axis=1)</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table.columns = </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                    <span class="p">)</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[1][1], prediction[1][2], prediction[1][3]</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = prediction.drop(prediction.columns[0], axis=1)</span>
<span class="sd">        output_table.columns = [&#39;Proba_0&#39;, &#39;Proba_1&#39;, &#39;Proba_2&#39;]</span>
<span class="sd">        return output_table</span>
<span class="sd">                    &quot;&quot;&quot;</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">h2o_returns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;prediction[1][</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">))]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">h2o_returns</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">prediction.columns = </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return prediction&quot;</span>
                    <span class="p">)</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[1][0], prediction[1][1], prediction[1][2], prediction[1][3]</span>
<span class="sd">    else:</span>
<span class="sd">        prediction.columns = [&#39;Classification&#39;, &#39;Proba_0&#39;, &#39;Proba_1&#39;, &#39;Proba_2&#39;]</span>
<span class="sd">        return prediction</span>
<span class="sd">                    &quot;&quot;&quot;</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="n">proba_returns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;prediction[0][</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">))]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proba_returns</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(prediction, columns=</span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return prediction[0][0], prediction[0][1], prediction[0][2]</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = pd.DataFrame(prediction, columns=[&#39;Proba_0&#39;, &#39;Proba_1&#39;, &#39;Proba_2&#39;])</span>
<span class="sd">        return output_table</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">returns</span>
            <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">proba_returns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;prediction[0][</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">))]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">target_values = </span><span class="si">{</span><span class="n">target_values</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">if input_array.shape[0] == 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return target_values[prediction[0].index(max(prediction[0]))], &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proba_returns</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">else:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table = pd.DataFrame(prediction, columns=</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">classifications = np.array(target_values)[np.argmax(output_table.values, axis=1)]</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">output_table.insert(0, &#39;</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, classifications)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">8</span><span class="si">}</span><span class="s2">return output_table&quot;</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    target_values = [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]</span>

<span class="sd">    if input_array.shape[0] == 1:</span>
<span class="sd">        return target_values[prediction[0].index(max(prediction[0]))], prediction[0][0], prediction[0][1], prediction[0][2]</span>
<span class="sd">    else:</span>
<span class="sd">        output_table = pd.DataFrame(prediction, columns=[&#39;Proba_0&#39;, &#39;Proba_1&#39;, &#39;Proba_2&#39;])</span>
<span class="sd">        classifications = np.array(target_values)[np.argmax(output_table.values, axis=1)]</span>
<span class="sd">        output_table.insert(0, &#39;Classification&#39;, classifications)</span>
<span class="sd">        return output_table</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_invalid_predict_config</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_invalid_predict_config</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;An invalid combination of score metrics, target values, predict &quot;</span>
            <span class="s2">&quot;returns, and predict return types was provided, such that the &quot;</span>
            <span class="s2">&quot;expected return statement for the score code could not be &quot;</span>
            <span class="s2">&quot;determined.&quot;</span>
        <span class="p">)</span>

<div class="viewcode-block" id="ScoreCode.convert_mas_to_cas">
<a class="viewcode-back" href="../../../api/pzmm/write_score_code.html#sasctl.pzmm.write_score_code.ScoreCode.convert_mas_to_cas">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">convert_mas_to_cas</span><span class="p">(</span><span class="n">mas_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">RestObj</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Using the generated score.sas code from the Python wrapper API, convert the</span>
<span class="sd">        SAS Microanalytic Service based code to CAS compatible.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mas_code : str</span>
<span class="sd">            String representation of the dmcas_packagescorecode.sas DS2 wrapper</span>
<span class="sd">        model : str, dict, or RestObj</span>
<span class="sd">            The name or id of the model, or a dictionary representation of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CASCode : str</span>
<span class="sd">            String representation of the dmcas_epscorecode.sas DS2 wrapper code</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">mr</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">output_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">out_var</span> <span class="ow">in</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;outputVariables&quot;</span><span class="p">]:</span>
            <span class="n">output_string</span> <span class="o">+=</span> <span class="s2">&quot;dcl &quot;</span>
            <span class="k">if</span> <span class="n">out_var</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
                <span class="n">output_string</span> <span class="o">=</span> <span class="n">output_string</span> <span class="o">+</span> <span class="s2">&quot;varchar(100) &quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output_string</span> <span class="o">+=</span> <span class="s2">&quot;double &quot;</span>
            <span class="n">output_string</span> <span class="o">+=</span> <span class="n">out_var</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">mas_code</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;score(&quot;</span><span class="p">)</span>
        <span class="n">finish</span> <span class="o">=</span> <span class="n">mas_code</span><span class="p">[</span><span class="n">start</span><span class="p">:]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;);&quot;</span><span class="p">)</span>
        <span class="n">score_vars</span> <span class="o">=</span> <span class="n">mas_code</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="mi">6</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="n">finish</span><span class="p">]</span>
        <span class="n">input_string</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">x</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">score_vars</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;double&quot;</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;in_out&quot;</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;varchar(100)&quot;</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">end_block</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;method run();</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">set SASEP.IN;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">score(</span><span class="si">{</span><span class="n">input_string</span><span class="si">}</span><span class="s2">);</span><span class="se">\n</span><span class="s2">end;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">enddata;&quot;</span>
        <span class="p">)</span>
        <span class="n">replace_strings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;package pythonScore / overwrite=yes;&quot;</span><span class="p">:</span> <span class="s2">&quot;data sasep.out;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dcl int resultCode revision;&quot;</span><span class="p">:</span> <span class="s2">&quot;dcl double resultCode revision;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="n">output_string</span><span class="p">,</span>
            <span class="s2">&quot;endpackage;&quot;</span><span class="p">:</span> <span class="n">end_block</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">replace_strings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">replace_strings</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">replace_strings</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">cas_code</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">replace_strings</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))],</span> <span class="n">mas_code</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cas_code</span></div>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_input_var_lists</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Using an input dataset, generate lists of variables and their types.</span>

<span class="sd">        MLFlow models are handled differently and expect a list of dicts instead of a</span>
<span class="sd">        Pandas DataFrame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input_data : pandas.DataFrame or list of dict</span>
<span class="sd">            The `DataFrame` object contains the training data, and includes only the</span>
<span class="sd">            predictor columns. The write_score_code function currently supports int(64),</span>
<span class="sd">            float(64), and string data types for scoring. Providing a list of dict</span>
<span class="sd">            objects signals that the model files are being created from an MLFlow model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        input_var_list : List of str</span>
<span class="sd">            A list of variable names for the input dataset.</span>
<span class="sd">        input_dtypes_list : List of str</span>
<span class="sd">            A list of variable types for the input dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="c1"># From the input dataframe columns, create a list of input variables,</span>
            <span class="c1"># then check for viability</span>
            <span class="n">input_var_list</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_check_for_invalid_variable_names</span><span class="p">(</span><span class="n">input_var_list</span><span class="p">)</span>
            <span class="n">input_dtypes_list</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For MLFlow models, extract the variables and data types</span>
            <span class="n">input_var_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">]</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_check_for_invalid_variable_names</span><span class="p">(</span><span class="n">input_var_list</span><span class="p">)</span>
            <span class="n">input_dtypes_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">input_var_list</span><span class="p">,</span> <span class="n">input_dtypes_list</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_check_viya_version</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">RestObj</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that a valid SAS Viya version and model argument are provided.</span>

<span class="sd">        For SAS Viya 3.5, model score code requires the model UUID.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : str, dict, or RestObj</span>
<span class="sd">            The name or id of the model, or a dictionary representation of</span>
<span class="sd">            the model. The default value is None and is only necessary for models that</span>
<span class="sd">            will be hosted on SAS Viya 3.5.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        model_id : str or None</span>
<span class="sd">            SAS Model Manager model uuid for SAS Viya 3.5 models or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># No session supplied, assume SAS Viya 4 model</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_session</span><span class="p">():</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;No current session connection was found to a SAS Viya server. Score &quot;</span>
                <span class="s2">&quot;code will be written under the assumption that the target server is &quot;</span>
                <span class="s2">&quot;SAS Viya 4.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Session and no model, raise error if SAS Viya 3.5 model</span>
        <span class="k">elif</span> <span class="n">current_session</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_session</span><span class="p">()</span><span class="o">.</span><span class="n">version_info</span><span class="p">()</span> <span class="o">==</span> <span class="mf">3.5</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SystemError</span><span class="p">(</span>
                    <span class="s2">&quot;Score code for SAS Viya 3.5 requires the model&#39;s &quot;</span>
                    <span class="s2">&quot;UUID. Please provide either the model name, uuid, or&quot;</span>
                    <span class="s2">&quot;dictionary response from mr.get_model(model).&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Session and model, return uuid if SAS Viya 3.5 model</span>
        <span class="k">elif</span> <span class="n">current_session</span><span class="p">()</span> <span class="ow">and</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_session</span><span class="p">()</span><span class="o">.</span><span class="n">version_info</span><span class="p">()</span> <span class="o">==</span> <span class="mf">3.5</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_model_id</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="ScoreCode.sanitize_model_prefix">
<a class="viewcode-back" href="../../../api/pzmm/write_score_code.html#sasctl.pzmm.write_score_code.ScoreCode.sanitize_model_prefix">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sanitize_model_prefix</span><span class="p">(</span><span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the model_prefix for a valid Python function name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prefix : str</span>
<span class="sd">            The variable for the model name that is used when naming model files.</span>
<span class="sd">            (For example: hmeqClassTree + [Score.py || .pickle]).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        model_prefix : str</span>
<span class="sd">            Returns a model_prefix, adjusted as needed for valid Python function names.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Replace model_prefix if a valid function name is not provided</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">():</span>
            <span class="n">new_prefix</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\W|^(?=\d)&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The model_prefix argument needs to be a valid Python function &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;name. The provided value of </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> has been replaced &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with </span><span class="si">{</span><span class="n">new_prefix</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">new_prefix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prefix</span></div>


    <span class="k">def</span> <span class="nf">_viya35_score_code_import</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">score_cas</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload the score code to SAS Model Manager and generate DS2 wrappers as needed.</span>

<span class="sd">        If score_cas is True, then the function pulls down the score.sas default wrapper</span>
<span class="sd">        generated in SAS Viya 3.5 and modifies it to work in both MAS and CAS.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prefix : str</span>
<span class="sd">            The variable for the model name that is used when naming model files.</span>
<span class="sd">            (For example: hmeqClassTree + [Score.py || .pickle]).</span>
<span class="sd">        model_id : str</span>
<span class="sd">            SAS Model Manager uuid for the model.</span>
<span class="sd">        score_cas : bool</span>
<span class="sd">            Sets whether models registered to SAS Viya 3.5 should be able to be scored</span>
<span class="sd">            and validated through both CAS and SAS Micro Analytic Service. If set to</span>
<span class="sd">            false, then the model will only be able to be scored and validated through</span>
<span class="sd">            SAS Micro Analytic Service. The default value is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mas_code : str</span>
<span class="sd">            A string representation of the dmcas_packagescorecode.sas code used in MAS.</span>
<span class="sd">        cas_code : str</span>
<span class="sd">            A string representation of the dmcas_epscorecode.sas code used in CAS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;score_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">.py&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_code</span><span class="p">,</span>
                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_and_copy_score_resources</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
        <span class="c1"># The typeConversion endpoint is only valid for models with Python score code</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">mr</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_id</span><span class="p">)</span>
        <span class="n">model</span><span class="p">[</span><span class="s2">&quot;scoreCodeType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Python&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">mr</span><span class="o">.</span><span class="n">update_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">mr</span><span class="o">.</span><span class="n">convert_python_to_ds2</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">score_cas</span><span class="p">:</span>
            <span class="n">model_contents</span> <span class="o">=</span> <span class="n">mr</span><span class="o">.</span><span class="n">get_model_contents</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">model_contents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;score.sas&quot;</span><span class="p">:</span>
                    <span class="n">mas_code</span> <span class="o">=</span> <span class="n">mr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;models/</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">modelId</span><span class="si">}</span><span class="s2">/contents/</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">/content&quot;</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">upload_and_copy_score_resources</span><span class="p">(</span>
                        <span class="n">model_id</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">MAS_CODE_NAME</span><span class="p">,</span>
                                <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">mas_code</span><span class="p">,</span>
                                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">cas_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_mas_to_cas</span><span class="p">(</span><span class="n">mas_code</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">upload_and_copy_score_resources</span><span class="p">(</span>
                        <span class="n">model</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">CAS_CODE_NAME</span><span class="p">,</span>
                                <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">cas_code</span><span class="p">,</span>
                                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">model</span> <span class="o">=</span> <span class="n">mr</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_id</span><span class="p">)</span>
                    <span class="n">model</span><span class="p">[</span><span class="s2">&quot;scoreCodeType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ds2MultiType&quot;</span>
                    <span class="n">mr</span><span class="o">.</span><span class="n">update_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">mas_code</span><span class="p">,</span> <span class="n">cas_code</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright Copyright  2019, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>